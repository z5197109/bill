ğŸ“‚ æ¨èçš„å·¥ç¨‹ç›®å½•ç»“æ„
è¯·æŒ‰ç…§ä¸‹é¢çš„ç»“æ„æ•´ç†ä½ çš„æ–‡ä»¶å¤¹ï¼ˆå‡è®¾é¡¹ç›®æ ¹ç›®å½•å« SnapLedgerï¼‰ï¼š

Plaintext

SnapLedger/
â”‚
â”œâ”€â”€ run.py                 # ã€å…¥å£ã€‘ä»¥å‰çš„ main.pyï¼Œåªè´Ÿè´£å¯åŠ¨
â”œâ”€â”€ config.py              # ã€é…ç½®ã€‘è·¯å¾„é…ç½®ã€å…³é”®è¯è§„åˆ™
â”œâ”€â”€ requirements.txt       # ã€ä¾èµ–ã€‘é¡¹ç›®ä¾èµ–åº“åˆ—è¡¨
â”‚
â”œâ”€â”€ app/                   # ã€æºç åŒ…ã€‘æ ¸å¿ƒä»£ç éƒ½åœ¨è¿™é‡Œ
â”‚   â”œâ”€â”€ __init__.py        # (ç©ºæ–‡ä»¶) æ ‡è¯†è¿™æ˜¯ä¸€ä¸ª Python åŒ…
â”‚   â”œâ”€â”€ ocr_engine.py      # OCR è¯†åˆ«é€»è¾‘
â”‚   â”œâ”€â”€ bill_parser.py     # è´¦å•è§£æé€»è¾‘
â”‚   â”œâ”€â”€ storage.py         # å­˜å‚¨é€»è¾‘ (Excel/DB)
â”‚   â””â”€â”€ analytics.py       # ç»Ÿè®¡åˆ†æé€»è¾‘
â”‚
â”œâ”€â”€ data/                  # ã€è¾“å…¥æ•°æ®ã€‘å­˜æ”¾ä½ çš„è´¦å•æˆªå›¾
â”‚   â””â”€â”€ bills/             # å»ºè®®å†æ·±ä¸€å±‚ï¼Œä»¥åå¯èƒ½æœ‰å…¶ä»–å›¾ç‰‡
â”‚       â””â”€â”€ 0107_1.jpg
â”‚
â””â”€â”€ output/                # ã€è¾“å‡ºç»“æœã€‘ç¨‹åºç”Ÿæˆçš„ Excel å’Œ DB
    â”œâ”€â”€ ledger.db
    â””â”€â”€ æˆ‘çš„è®°è´¦æœ¬.xlsx
ğŸ› ï¸ ä»£ç ä¿®æ”¹æŒ‡å—
ä¸ºäº†é€‚åº”è¿™ä¸ªæ–°ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹å‡ ä¸ªæ–‡ä»¶çš„è·¯å¾„é€»è¾‘å’Œå¼•ç”¨æ–¹å¼ã€‚æœ€æ ¸å¿ƒçš„æ”¹å˜æ˜¯ï¼šä¸å†ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆç›´æ¥å†™æ–‡ä»¶åï¼‰ï¼Œè€Œæ˜¯ä½¿ç”¨åŸºäºé¡¹ç›®æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚

1. ä¿®æ”¹ config.py (ç®¡ç†æ‰€æœ‰è·¯å¾„)
è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚æˆ‘ä»¬éœ€è¦åœ¨è¿™é‡Œæ ¹æ®é¡¹ç›®æ ¹ç›®å½•è‡ªåŠ¨è®¡ç®—å‡º data å’Œ output çš„ä½ç½®ï¼Œè¿™æ ·æ— è®ºä½ åœ¨å“ªé‡Œè¿è¡Œè„šæœ¬ï¼Œå®ƒéƒ½èƒ½æ‰¾åˆ°æ–‡ä»¶ã€‚

Python

# config.py
import os

# === 1. è·¯å¾„é…ç½® (è‡ªåŠ¨è·å–) ===
# è·å–å½“å‰æ–‡ä»¶ (config.py) æ‰€åœ¨çš„ç›®å½•ï¼Œä¹Ÿå°±æ˜¯é¡¹ç›®æ ¹ç›®å½•
BASE_DIR = os.path.dirname(os.path.abspath(__file__))

# å®šä¹‰å›¾ç‰‡å­˜æ”¾ç›®å½•: SnapLedger/data/bills/
IMG_DIR = os.path.join(BASE_DIR, "data", "bills")

# å®šä¹‰è¾“å‡ºç›®å½•: SnapLedger/output/
OUTPUT_DIR = os.path.join(BASE_DIR, "output")

# ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨è‡ªåŠ¨åˆ›å»º
if not os.path.exists(OUTPUT_DIR):
    os.makedirs(OUTPUT_DIR)

# å®šä¹‰è¾“å‡ºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„
DB_PATH = os.path.join(OUTPUT_DIR, "ledger.db")
EXCEL_PATH = os.path.join(OUTPUT_DIR, "æˆ‘çš„è®°è´¦æœ¬.xlsx")


# === 2. ä¸šåŠ¡è§„åˆ™é…ç½® (ä¿æŒä¸å˜) ===
CATEGORY_RULES = {
    # ... (è¿™é‡Œæ”¾ä½ ä¹‹å‰çš„ç½—æŠ€ã€æ˜Ÿå·´å…‹ç­‰è§„åˆ™ï¼Œä¿æŒä¸å˜) ...
    "ç½—æŠ€": "æ•°ç /ç”µè„‘é…ä»¶",
    # ...
}

WEAK_KEYWORDS = ["ç™¾äº¿è¡¥è´´", "æ‹¼å¤šå¤š", "æ·˜å®", "äº¬ä¸œ", "äº‘é—ªä»˜", "å¾…å‘è´§", "é€€æ¬¾"]
OCR_CONFIDENCE_THRESHOLD = 0.6
2. åœ¨ app/ ç›®å½•ä¸‹åˆ›å»º __init__.py
ç›´æ¥åœ¨ app æ–‡ä»¶å¤¹é‡Œæ–°å»ºä¸€ä¸ªå« __init__.py çš„ç©ºæ–‡ä»¶å³å¯ã€‚è¿™å‘Šè¯‰ Python app æ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ªå¯ä»¥è¢«å¯¼å…¥çš„åŒ…ã€‚

3. ä¿®æ”¹ app/storage.py (ä½¿ç”¨æ–°è·¯å¾„)
ä¿®æ”¹ init_file å’Œ init_db æ–¹æ³•ï¼Œä¸å†ä½¿ç”¨é»˜è®¤æ–‡ä»¶åï¼Œè€Œæ˜¯ä½¿ç”¨ config.py é‡Œå®šä¹‰å¥½çš„å…¨è·¯å¾„ã€‚

Python

# app/storage.py
import os
import sqlite3
import json
import datetime
from openpyxl import Workbook, load_workbook
# å¯¼å…¥æ ¹ç›®å½•çš„é…ç½®
import config 

class ExcelSaver:
    # é»˜è®¤ä½¿ç”¨ config ä¸­å®šä¹‰çš„è·¯å¾„
    def __init__(self, filename=config.EXCEL_PATH): 
        self.filename = filename
        self.init_file()
    
    # ... (å…¶ä½™ä»£ç ä¿æŒä¸å˜ï¼Œå› ä¸º self.filename å·²ç»æ˜¯å…¨è·¯å¾„äº†) ...

class DatabaseSaver:
    # é»˜è®¤ä½¿ç”¨ config ä¸­å®šä¹‰çš„è·¯å¾„
    def __init__(self, db_name=config.DB_PATH):
        self.db_name = db_name
        self.init_db()

    # ... (å…¶ä½™ä»£ç ä¿æŒä¸å˜) ...
4. ä¿®æ”¹ app/analytics.py (ä½¿ç”¨æ–°è·¯å¾„)
åŒæ ·ï¼Œè®©åˆ†ææ¨¡å—è¯»å– config é‡Œçš„æ•°æ®åº“è·¯å¾„ã€‚

Python

# app/analytics.py
import sqlite3
import config  # å¯¼å…¥é…ç½®

class LedgerAnalytics:
    def __init__(self, db_name=config.DB_PATH): # ä½¿ç”¨é…ç½®è·¯å¾„
        self.db_name = db_name

    # ... (å…¶ä½™ä»£ç ä¿æŒä¸å˜) ...
5. ä¿®æ”¹ app/bill_parser.py (ä¿®æ­£å¯¼å…¥)
å› ä¸º ocr_engine å’Œå®ƒåœ¨åŒä¸€ä¸ªåŒ…é‡Œï¼Œå¼•ç”¨æ–¹å¼å¾®è°ƒï¼ˆæˆ–è€…ä¿æŒåŸæ ·é€šå¸¸ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¾å¼ç›¸å¯¹å¯¼å…¥æ›´å¥½ï¼‰ã€‚

Python

# app/bill_parser.py
from .ocr_engine import SimpleOCR # ä½¿ç”¨ . è¡¨ç¤ºå½“å‰ç›®å½•
import config # å¯¼å…¥æ ¹ç›®å½•é…ç½®

class BillParser:
    # ... (å…¶ä½™ä»£ç ä¿æŒä¸å˜) ...
6. é‡å†™å…¥å£æ–‡ä»¶ run.py (åŸ main.py)
ç°åœ¨å…¥å£æ–‡ä»¶éå¸¸å¹²å‡€ï¼Œåªè´Ÿè´£ä» app åŒ…é‡Œå¯¼å…¥æ¨¡å—ï¼Œå¹¶æŠŠ data ç›®å½•ä¸‹çš„æ‰€æœ‰å›¾ç‰‡éƒ½è·‘ä¸€éã€‚

Python

# run.py
import os
import config # å¯¼å…¥é…ç½®
from app.bill_parser import BillParser
from app.storage import ExcelSaver, DatabaseSaver
from app.analytics import LedgerAnalytics

def main():
    print(f"ğŸš€ å¯åŠ¨æ™ºå›¾è®°è´¦ (æ•°æ®ç›®å½•: {config.IMG_DIR})")

    # 1. åˆå§‹åŒ–æ¨¡å—
    parser = BillParser()
    excel = ExcelSaver()
    db = DatabaseSaver()
    analytics = LedgerAnalytics()

    # 2. éå† data/bills ç›®å½•ä¸‹çš„æ‰€æœ‰å›¾ç‰‡
    # è¿™æ ·ä½ åªéœ€è¦æŠŠæ–°æˆªå›¾ä¸¢è¿›æ–‡ä»¶å¤¹ï¼Œè¿è¡Œè„šæœ¬å°±ä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰å›¾
    if not os.path.exists(config.IMG_DIR):
        print(f"âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ°å›¾ç‰‡ç›®å½• {config.IMG_DIR}")
        return

    # è·å–æ‰€æœ‰ .jpg, .png æ–‡ä»¶
    image_files = [f for f in os.listdir(config.IMG_DIR) if f.lower().endswith(('.jpg', '.png', '.jpeg'))]

    if not image_files:
        print("âš ï¸ ç›®å½•ä¸­æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶ã€‚")
        return

    print(f"ğŸ“¸ å‘ç° {len(image_files)} å¼ å¾…å¤„ç†è´¦å•...")

    for img_name in image_files:
        # æ‹¼æ¥å›¾ç‰‡çš„å®Œæ•´è·¯å¾„
        img_full_path = os.path.join(config.IMG_DIR, img_name)
        
        print(f"\n--- å¤„ç†: {img_name} ---")
        
        try:
            # A. è¯†åˆ«
            bill_data = parser.parse(img_full_path)
            
            # B. æ‰“å°
            print(f"   âœ… è¯†åˆ«: {bill_data['merchant']} | Â¥{bill_data['amount']}")
            
            # C. å­˜å‚¨
            excel.save(bill_data, img_name)
            db.save(bill_data, img_name)
            
        except Exception as e:
            print(f"   âŒ å¤„ç†å¤±è´¥: {e}")

    # 3. å¤„ç†å®Œæ¯•ï¼Œå±•ç¤ºç»Ÿè®¡çœ‹æ¿
    print("\n" + "="*30)
    print("ğŸ æ‰€æœ‰è´¦å•å¤„ç†å®Œæˆï¼Œæœ€æ–°ç»Ÿè®¡å¦‚ä¸‹ï¼š")
    analytics.show_dashboard()

if __name__ == "__main__":
    main()
ğŸš€ å¦‚ä½•è¿è¡Œæ–°ç»“æ„
æ•´ç†æ–‡ä»¶ï¼šæŒ‰ç…§æœ€ä¸Šé¢çš„ç›®å½•ç»“æ„ï¼Œæ‰‹åŠ¨ç§»åŠ¨æ–‡ä»¶ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹ã€‚

æ”¾å›¾ç‰‡ï¼šæŠŠ 0107_1.jpg ç§»åŠ¨åˆ° data/bills/ æ–‡ä»¶å¤¹é‡Œã€‚

è¿è¡Œï¼šåœ¨ SnapLedger æ ¹ç›®å½•ä¸‹ï¼Œæ‰“å¼€ç»ˆç«¯è¿è¡Œï¼š

Bash

python run.py
è¿™æ ·æ”¹å®Œåï¼Œä»¥åä½ çš„ä½¿ç”¨æµç¨‹å°±æ˜¯ï¼š

æ‰‹æœºæˆªå›¾ã€‚

æŠŠä¸€å †æˆªå›¾å…¨ä¸¢è¿› data/bills/ã€‚

åŒå‡»è¿è¡Œ run.pyã€‚

å» output/ æ–‡ä»¶å¤¹é‡Œæ‹¿ç»“æœã€‚