import{T as Be,C as L,S as Je,a as ha,E as ga,R as pa,b as T,c,B as j,d as wr,r as l,F as u,U as _r,e as ya,A as ct,f as D,L as ur,g as rt,I as z,h as ie,M as E,i as mr,D as it,j as Ke,s as ce,k as Lt,l as Q,m as je,n as p,P as At,o as ye,p as xa,q as hr,t as xe,u as fa,v as ja,w as Te,x as nt,y as at,z as ba}from"./antd-cDdHMnJl.js";import{g as wa}from"./react-Cgg2GOmP.js";(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))g(i);new MutationObserver(i=>{for(const x of i)if(x.type==="childList")for(const v of x.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&g(v)}).observe(document,{childList:!0,subtree:!0});function f(i){const x={};return i.integrity&&(x.integrity=i.integrity),i.referrerPolicy&&(x.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?x.credentials="include":i.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function g(i){if(i.ep)return;i.ep=!0;const x=f(i);fetch(i.href,x)}})();var Nt={exports:{}},qe={};var gr;function _a(){if(gr)return qe;gr=1;var m=Symbol.for("react.transitional.element"),y=Symbol.for("react.fragment");function f(g,i,x){var v=null;if(x!==void 0&&(v=""+x),i.key!==void 0&&(v=""+i.key),"key"in i){x={};for(var C in i)C!=="key"&&(x[C]=i[C])}else x=i;return i=x.ref,{$$typeof:m,type:g,key:v,ref:i!==void 0?i:null,props:x}}return qe.Fragment=y,qe.jsx=f,qe.jsxs=f,qe}var pr;function va(){return pr||(pr=1,Nt.exports=_a()),Nt.exports}var e=va(),Bt={exports:{}},Et,yr;function Ca(){if(yr)return Et;yr=1;var m="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Et=m,Et}var Pt,xr;function ka(){if(xr)return Pt;xr=1;var m=Ca();function y(){}function f(){}return f.resetWarningCache=y,Pt=function(){function g(v,C,Y,B,I,R){if(R!==m){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}g.isRequired=g;function i(){return g}var x={array:g,bigint:g,bool:g,func:g,number:g,object:g,string:g,symbol:g,any:g,arrayOf:i,element:g,elementType:g,instanceOf:i,node:g,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:f,resetWarningCache:y};return x.PropTypes=x,x},Pt}var fr;function Ta(){return fr||(fr=1,Bt.exports=ka()()),Bt.exports}var Sa=Ta();const k=wa(Sa),{Text:zt}=Be;function $t({amount:m,nonBudgetAmount:y,loading:f,currency:g="Â¥"}){return e.jsx(L,{title:"æœ¬æœˆæ”¯å‡º",className:"monthly-spending-card",style:{height:"100%"},children:f?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(Je,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(zt,{type:"secondary",children:"æ­£åœ¨åŠ è½½æ”¯å‡ºæ•°æ®..."})})]}):e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{className:"monthly-amount",style:{fontSize:"36px",fontWeight:"bold",color:"#1890ff",marginBottom:"8px",lineHeight:1.2},children:[g," ",jr(m)]}),e.jsx(zt,{type:"secondary",style:{fontSize:"14px"},children:"å½“å‰æœˆä»½æ€»æ”¯å‡º"}),Number(y)>0&&e.jsx("div",{style:{marginTop:4},children:e.jsxs(zt,{type:"secondary",style:{fontSize:"12px"},children:["å…¶ä¸­ ",g," ",jr(y)," ä¸è®¡å…¥é¢„ç®—"]})})]})})}function jr(m){if(m==null)return"0.00";const y=Number(m);return isNaN(y)?"0.00":y.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2})}$t.propTypes={amount:k.number,nonBudgetAmount:k.number,loading:k.bool,currency:k.string};$t.defaultProps={amount:0,nonBudgetAmount:0,loading:!1,currency:"Â¥"};const{Text:Ye}=Be;function Wt({budgetInfo:m,loading:y}){if(y)return e.jsx(L,{title:"é¢„ç®—çŠ¶æ€",className:"budget-status-card",style:{height:"100%"},children:e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(Je,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(Ye,{type:"secondary",children:"æ­£åœ¨åŠ è½½é¢„ç®—æ•°æ®..."})})]})});const{total_budget:f=0,used_percentage:g=0,time_progress:i=0,remaining_budget:x=0}=m||{},v=g-i,C=x<0||g>100,Y=!C&&v>10,B=C?"#fff2f0":Y?"#fff7e6":"#f6ffed",I=C?"#cf1322":Y?"#d46b08":"#389e0d";return e.jsx(L,{title:"é¢„ç®—çŠ¶æ€",className:"budget-status-card",style:{height:"100%"},children:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsxs(Ye,{strong:!0,style:{fontSize:"16px"},children:["æ€»é¢„ç®—: Â¥",Se(f)]})}),e.jsx("div",{style:{marginBottom:"16px"},children:e.jsxs("div",{className:"budget-progress-container",children:[e.jsxs("div",{className:"budget-progress-bar",style:{width:"100%",height:"20px",backgroundColor:"#f0f0f0",borderRadius:"10px",position:"relative",overflow:"hidden"},children:[e.jsx("div",{className:"budget-progress-used",style:{width:`${Math.min(g,100)}%`,height:"100%",backgroundColor:"#1A237E",position:"absolute",left:0,top:0,transition:"width 0.3s ease",borderRadius:g>=100?"10px":"10px 0 0 10px"}}),g<100&&e.jsx("div",{style:{width:`${100-g}%`,height:"100%",backgroundColor:"#90CAF9",position:"absolute",right:0,top:0,borderRadius:"0 10px 10px 0"}}),e.jsx("div",{className:"budget-progress-marker",style:{position:"absolute",left:`${Math.min(i,100)}%`,top:"-2px",height:"calc(100% + 4px)",width:"2px",backgroundColor:"#1890ff",borderLeft:"2px dashed #1890ff",zIndex:10}}),e.jsx("div",{style:{position:"absolute",left:`${Math.min(i,100)}%`,top:"-25px",transform:"translateX(-50%)",fontSize:"10px",color:"#1890ff",fontWeight:"bold",whiteSpace:"nowrap"},children:"ä»Šå¤©"})]}),e.jsxs("div",{className:"budget-progress-labels",style:{display:"flex",justifyContent:"space-between",marginTop:"8px",fontSize:"12px"},children:[e.jsxs(Ye,{type:"secondary",children:["å·²ç”¨ ",Number(g).toFixed(1),"%"]}),e.jsxs(Ye,{type:"secondary",children:["æœ¬æœˆå·²è¿‡ ",Number(i).toFixed(1),"%"]})]})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{children:(()=>{const R=x<0||g>100,d=R?"å¼€æ”¯è¶…é¢":"å‰©ä½™é¢„ç®—",W=R?Math.abs(x):x,$=R?"#ff4d4f":"#52c41a";return e.jsxs(Ye,{style:{fontSize:"14px"},children:[d,":",e.jsxs("span",{style:{color:$,fontWeight:"bold",marginLeft:"4px"},children:["Â¥",Se(W)]})]})})()}),e.jsx("div",{children:Da(g,i)})]}),e.jsx("div",{style:{marginTop:"12px",padding:"8px",backgroundColor:B,borderRadius:"4px"},children:e.jsx(Ye,{style:{fontSize:"13px",color:I},children:(()=>{const R=Ia(f,x);return R.detail?e.jsx(ha,{title:R.detail,children:e.jsx("span",{style:{cursor:"help"},children:R.summary})}):R.summary})()})})]})})}function Se(m){if(m==null)return"0.00";const y=Number(m);return isNaN(y)?"0.00":Math.abs(y).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2})}function Da(m,y){const f=m-y;return m>100?e.jsx("span",{style:{color:"#ff4d4f",fontSize:"12px"},children:"âš ï¸ è¶…é¢„ç®—"}):f>10?e.jsx("span",{style:{color:"#faad14",fontSize:"12px"},children:"âš¡ åé«˜"}):e.jsx("span",{style:{color:"#52c41a",fontSize:"12px"},children:"âœ… è‰¯å¥½"})}function Ia(m,y,f,g){const i=new Date,x=i.getFullYear(),v=i.getMonth(),C=new Date(x,v+1,0).getDate(),Y=i.getDate(),B=Math.max(0,C-Y),I=Math.max(1,B),R=m>0?m/C:0,d=I>0?y/I:y,W=()=>null;if(y<0){const ae=Math.abs(y);return{summary:e.jsxs("span",{children:[e.jsx(W,{}),"æœ¬æœˆå‰©ä½™ ",e.jsx("b",{children:B})," å¤©ï¼Œé¢„ç®—ç¼ºå£ ",e.jsxs("b",{children:["Â¥",Se(ae)]})]}),detail:null}}if(!m||m<=0)return{summary:e.jsxs("span",{children:[e.jsx(W,{}),"æœ¬æœˆå‰©ä½™ ",e.jsx("b",{children:B})," å¤©ï¼Œæ—¥å‡å¯ç”¨ ",e.jsxs("b",{children:["Â¥",Se(d)]})]}),detail:null};const $=d-R,ne=$>=0,be=ne?"ğŸ“ˆ":"ğŸ“‰",we=ne?"æé«˜":"ä¸‹é™";return{summary:e.jsxs("span",{children:[e.jsx(W,{}),"æœ¬æœˆå‰©ä½™ ",e.jsx("b",{children:B})," å¤©ï¼Œæ—¥å‡å¯ç”¨ ",e.jsxs("b",{children:["Â¥",Se(d)]})]}),detail:e.jsxs("span",{children:["è¾ƒæœˆå‡æ—¥é¢„ç®— ",e.jsxs("b",{children:["Â¥",Se(R)]}),"/å¤© ",we," ",e.jsxs("b",{children:["Â¥",Se(Math.abs($))]}),"/å¤© ",be,"ã€‚"]})}}Wt.propTypes={budgetInfo:k.shape({total_budget:k.number,used_percentage:k.number,time_progress:k.number,remaining_budget:k.number}),loading:k.bool};Wt.defaultProps={budgetInfo:{total_budget:0,used_percentage:0,time_progress:0,remaining_budget:0},loading:!1};const{Text:st}=Be;function qt({categories:m,loading:y}){if(y)return e.jsx(L,{title:"ä¸»è¦æ”¯å‡ºç±»åˆ«",className:"category-breakdown-card",children:e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(Je,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(st,{type:"secondary",children:"æ­£åœ¨åŠ è½½ç±»åˆ«æ•°æ®..."})})]})});if(!m||m.length===0)return e.jsx(L,{title:"ä¸»è¦æ”¯å‡ºç±»åˆ«",className:"category-breakdown-card",children:e.jsx(ga,{image:e.jsx(pa,{style:{fontSize:48,color:"#d9d9d9"}}),description:e.jsxs("span",{style:{color:"#999"},children:["æš‚æ— æ”¯å‡ºæ•°æ®",e.jsx("br",{}),e.jsx(st,{type:"secondary",style:{fontSize:"12px"},children:"å¼€å§‹è®°å½•è´¦å•åï¼Œè¿™é‡Œå°†æ˜¾ç¤ºæ‚¨çš„ä¸»è¦æ”¯å‡ºç±»åˆ«"})]})})});const f=[...m].sort((g,i)=>(i.amount||0)-(g.amount||0)).slice(0,3);return e.jsxs(L,{title:"ä¸»è¦æ”¯å‡ºç±»åˆ«",className:"category-breakdown-card",extra:e.jsxs(st,{type:"secondary",style:{fontSize:"12px"},children:["å‰ ",Math.min(m.length,3)," é¡¹"]}),children:[e.jsx(T,{gutter:[16,16],children:f.map((g,i)=>e.jsx(c,{xs:24,sm:8,children:e.jsx(vr,{category:g,rank:i+1})},`${g.category}-${i}`))}),m.length>3&&e.jsx("div",{style:{marginTop:"16px",padding:"8px 12px",backgroundColor:"#fafafa",borderRadius:"6px",textAlign:"center"},children:e.jsxs(st,{type:"secondary",style:{fontSize:"12px"},children:["è¿˜æœ‰ ",m.length-3," ä¸ªå…¶ä»–ç±»åˆ«"]})})]})}function vr({category:m,rank:y}){const{category:f="æœªçŸ¥ç±»åˆ«",amount:g=0,count:i=0,icon:x="ğŸ“¦",color:v="#95de64"}=m;return e.jsxs("div",{className:"category-item",style:{display:"flex",alignItems:"center",padding:"16px 12px",backgroundColor:"#fafafa",borderRadius:"8px",border:"1px solid #f0f0f0",position:"relative",transition:"all 0.3s ease",cursor:"pointer"},onMouseEnter:C=>{C.currentTarget.style.backgroundColor="#f0f0f0",C.currentTarget.style.transform="translateY(-2px)",C.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)"},onMouseLeave:C=>{C.currentTarget.style.backgroundColor="#fafafa",C.currentTarget.style.transform="translateY(0)",C.currentTarget.style.boxShadow="none"},children:[e.jsx("div",{className:"category-rank-badge",style:{backgroundColor:v,position:"absolute",top:"-8px",right:"-8px",width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:"bold",color:"white",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)",zIndex:10},children:y}),e.jsx("div",{className:"category-icon",style:{fontSize:"28px",marginRight:"12px",minWidth:"36px",textAlign:"center",filter:`drop-shadow(0 2px 4px ${v}40)`},children:x}),e.jsxs("div",{className:"category-info",style:{flex:1,minWidth:0},children:[e.jsx("div",{className:"category-name",style:{fontWeight:"bold",marginBottom:"4px",fontSize:"14px",color:"#262626",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:f,children:f}),e.jsxs("div",{className:"category-amount",style:{color:v,marginBottom:"2px",fontSize:"16px",fontWeight:"600"},children:["Â¥",Oa(g)]}),e.jsxs("div",{className:"category-count",style:{fontSize:"11px",color:"#8c8c8c"},children:[i," ç¬”äº¤æ˜“"]})]}),e.jsx("div",{style:{width:"4px",height:"40px",backgroundColor:v,borderRadius:"2px",marginLeft:"8px",opacity:.8}})]})}function Oa(m){if(m==null)return"0.00";const y=Number(m);return isNaN(y)?"0.00":y.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2})}qt.propTypes={categories:k.arrayOf(k.shape({category:k.string,amount:k.number,count:k.number,icon:k.string,color:k.string})),loading:k.bool};qt.defaultProps={categories:[],loading:!1};vr.propTypes={category:k.shape({category:k.string,amount:k.number,count:k.number,icon:k.string,color:k.string}).isRequired,rank:k.number.isRequired};function Ut({onAddBill:m,loading:y=!1}){return e.jsxs("div",{className:"add-bill-button-container",style:{position:"fixed",bottom:"24px",right:"24px",zIndex:1e3},children:[e.jsx(j,{type:"primary",size:"large",shape:"round",icon:e.jsx(wr,{}),onClick:m,loading:y,className:"add-bill-button",style:{backgroundColor:"#001529",borderColor:"#001529",height:"48px",paddingLeft:"20px",paddingRight:"20px",fontSize:"16px",fontWeight:"500",boxShadow:"0 4px 12px rgba(0, 21, 41, 0.3)",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:f=>{y||(f.currentTarget.style.transform="translateY(-2px)",f.currentTarget.style.boxShadow="0 6px 16px rgba(0, 21, 41, 0.4)",f.currentTarget.style.backgroundColor="#002766")},onMouseLeave:f=>{y||(f.currentTarget.style.transform="translateY(0)",f.currentTarget.style.boxShadow="0 4px 12px rgba(0, 21, 41, 0.3)",f.currentTarget.style.backgroundColor="#001529")},onMouseDown:f=>{y||(f.currentTarget.style.transform="translateY(0) scale(0.95)")},onMouseUp:f=>{y||(f.currentTarget.style.transform="translateY(-2px) scale(1)")},children:"æ·»åŠ è´¦å•"}),e.jsx("div",{className:"add-bill-button-ripple",style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",borderRadius:"24px",background:"rgba(255, 255, 255, 0.1)",transform:"translate(-50%, -50%) scale(0)",opacity:0,pointerEvents:"none",transition:"all 0.6s cubic-bezier(0.4, 0, 0.2, 1)"}})]})}Ut.propTypes={onAddBill:k.func.isRequired,loading:k.bool};Ut.defaultProps={loading:!1};const{Text:Ae,Title:br}=Be;function Cr({visible:m,onClose:y,onSuccess:f}){const[g,i]=l.useState(0),[x,v]=l.useState(!1),[C,Y]=l.useState(null),[B]=u.useForm(),[I,R]=l.useState({item:null,amount:null}),[d,W]=l.useState([]),[$,ne]=l.useState("field"),be=async M=>{v(!0);const O=new FormData;O.append("file",M);try{const Z=await(await fetch("/api/templates/ocr",{method:"POST",body:O})).json();Z.success?(Y(Z.data),ce.success("OCRè¯†åˆ«æˆåŠŸ"),i(1)):ce.error(Z.error||"OCRè¯†åˆ«å¤±è´¥")}catch(q){ce.error("ä¸Šä¼ å¤±è´¥: "+q.message)}finally{v(!1)}return!1},we=async()=>{if(g===0&&!C){ce.warning("è¯·å…ˆä¸Šä¼ è´¦å•æˆªå›¾å¹¶å®Œæˆè¯†åˆ«");return}if(g===1){if(I.item===null||I.amount===null){ce.warning("è¯·è‡³å°‘é€‰æ‹©å•†å“åç§°å’Œé‡‘é¢æ‰€åœ¨è¡Œ");return}try{await B.validateFields(["matchKeywords"])}catch{return}}i(g+1)},ae=()=>{i(g-1)},_e=async()=>{try{const M=await B.validateFields();v(!0);const O=B.getFieldValue("matchKeywords")||M.matchKeywords,q={name:M.name,priority:M.priority||90,match:{any:O?O.split(",").map(de=>de.trim()):[],min_score:1},scope:{},extract:{item:{line:I.item,search_window:0,join_next:0,clean:!0,skip_datetime_phone:!0},amount:{line:I.amount,search_window:0,require_regex:"(Â¥|ï¿¥)\\s*\\d",money_pick:"max_abs",abs:!0,round:2}}};M.category&&(q.category=M.category);const le=await(await fetch("/api/templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:q,temp_filename:C?.temp_filename})})).json();le.success?(ce.success("æ¨¡æ¿ä¿å­˜æˆåŠŸ"),f&&f(le.data),se()):ce.error(le.error||"ä¿å­˜å¤±è´¥")}catch(M){ce.error("ä¿å­˜å¤±è´¥: "+M.message)}finally{v(!1)}},se=()=>{i(0),Y(null),R({item:null,amount:null}),W([]),ne("field"),B.resetFields(),y&&y()},X=[{title:"ä¸Šä¼ å›¾ç‰‡",content:e.jsx("div",{style:{textAlign:"center",padding:"40px 20px"},children:e.jsxs(_r.Dragger,{accept:"image/*",beforeUpload:be,showUploadList:!1,disabled:x,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ya,{style:{fontSize:48,color:"#1890ff"}})}),e.jsx("p",{className:"ant-upload-text",children:"ç‚¹å‡»æˆ–æ‹–æ‹½è´¦å•å›¾ç‰‡åˆ°æ­¤å¤„"}),e.jsx("p",{className:"ant-upload-hint",children:"æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 16MB"})]})})},{title:"é€‰æ‹©å­—æ®µ",content:C&&e.jsxs("div",{children:[e.jsx(ct,{message:$==="field"?"è¯·é€‰æ‹©å•†å“åç§°å’Œé‡‘é¢æ‰€åœ¨çš„è¡Œå·ï¼ˆå†æ¬¡ç‚¹å‡»å¯å–æ¶ˆé€‰æ‹©ï¼‰":"è¯·ç‚¹å‡»è¡Œå·é€‰æ‹©åŒ¹é…å…³é”®è¯ï¼ˆå¯å¤šé€‰ï¼Œå†æ¬¡ç‚¹å‡»å¯å–æ¶ˆï¼‰",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(D,{children:[e.jsx(Ae,{strong:!0,children:"é€‰æ‹©æ¨¡å¼ï¼š"}),e.jsx(j,{type:$==="field"?"primary":"default",size:"small",onClick:()=>ne("field"),children:"é€‰æ‹©å­—æ®µ"}),e.jsx(j,{type:$==="keyword"?"primary":"default",size:"small",onClick:()=>ne("keyword"),children:"é€‰æ‹©å…³é”®è¯"})]})}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx(br,{level:5,children:"OCRè¯†åˆ«ç»“æœ"}),e.jsx(ur,{size:"small",bordered:!0,dataSource:C.lines,style:{maxHeight:400,overflow:"auto"},renderItem:(M,O)=>{const q=I.item===O,Z=I.amount===O,le=d.includes(O);let de="white";return q?de="#e6f7ff":Z?de="#fff7e6":le&&(de="#f6ffed"),e.jsx(ur.Item,{style:{cursor:"pointer",backgroundColor:de},onClick:()=>{if($==="field")q?R({...I,item:null}):Z?R({...I,amount:null}):I.item===null?R({...I,item:O}):I.amount===null?R({...I,amount:O}):R({item:O,amount:null});else{const ve=le?d.filter(P=>P!==O):[...d,O];W(ve);const De=ve.map(P=>C.lines[P]).join(",");B.setFieldsValue({matchKeywords:De})}},children:e.jsxs(D,{children:[e.jsx(rt,{color:le?"green":"blue",children:O}),e.jsx(Ae,{children:M}),q&&e.jsx(rt,{color:"cyan",children:"å•†å“åç§°"}),Z&&e.jsx(rt,{color:"orange",children:"é‡‘é¢"}),le&&e.jsx(rt,{color:"green",children:"å…³é”®è¯"})]})})}}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(Ae,{strong:!0,children:"å·²é€‰æ‹©ï¼š"}),e.jsxs("div",{style:{marginTop:8},children:[e.jsxs(Ae,{children:["å•†å“åç§°è¡Œ ",I.item!==null?I.item:"æœªé€‰æ‹©"]}),e.jsx("br",{}),e.jsxs(Ae,{children:["é‡‘é¢è¡Œ ",I.amount!==null?I.amount:"æœªé€‰æ‹©"]}),e.jsx("br",{}),e.jsxs(Ae,{children:["å…³é”®è¯è¡Œ ",d.length>0?d.join(", "):"æœªé€‰æ‹©"]})]})]}),e.jsx(u.Item,{label:"åŒ¹é…å…³é”®è¯",name:"matchKeywords",rules:[{required:!0,message:"è¯·è¾“å…¥åŒ¹é…å…³é”®è¯"}],extra:"ç‚¹å‡»ä¸Šæ–¹è¡Œå·é€‰æ‹©ï¼Œæˆ–ç”¨é€—å·åˆ†éš”å¤šä¸ªå…³é”®è¯",style:{marginTop:12},children:e.jsx(z,{placeholder:"è®¢å•ä¿¡æ¯,å®ä»˜æ¬¾"})})]}),e.jsxs("div",{style:{width:300},children:[e.jsx(br,{level:5,children:"å›¾ç‰‡é¢„è§ˆ"}),e.jsx("img",{src:C.preview,alt:"è´¦å•é¢„è§ˆ",style:{width:"100%",border:"1px solid #d9d9d9",borderRadius:4}})]})]})]})},{title:"é…ç½®æ¨¡æ¿",content:e.jsxs(e.Fragment,{children:[e.jsx(u.Item,{label:"æ¨¡æ¿åç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥æ¨¡æ¿åç§°"}],children:e.jsx(z,{placeholder:"ä¾‹å¦‚: taobao_order_detail"})}),e.jsx(u.Item,{label:"ä¼˜å…ˆçº§",name:"priority",extra:"æ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå»ºè®®èŒƒå›´ 50-150",children:e.jsx(ie,{min:1,max:200,style:{width:"100%"}})})]})}];return e.jsxs(E,{title:"è´¦å•æ¨¡æ¿å‘å¯¼",open:m,onCancel:se,width:800,footer:null,destroyOnClose:!0,style:{top:"20%"},children:[e.jsx(mr,{current:g,style:{marginBottom:24},children:X.map((M,O)=>e.jsx(mr.Step,{title:M.title},M.title))}),e.jsx(u,{form:B,layout:"vertical",initialValues:{priority:90},children:e.jsx("div",{style:{minHeight:300},children:X[g].content})}),e.jsx(it,{}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(D,{children:[g>0&&e.jsx(j,{onClick:ae,disabled:x,children:"ä¸Šä¸€æ­¥"}),g<X.length-1&&e.jsx(j,{type:"primary",onClick:we,disabled:x,children:"ä¸‹ä¸€æ­¥"}),g===X.length-1&&e.jsx(j,{type:"primary",icon:e.jsx(Ke,{}),onClick:_e,loading:x,children:"ä¿å­˜æ¨¡æ¿"})]})})]})}Cr.propTypes={visible:k.bool.isRequired,onClose:k.func,onSuccess:k.func};const{Title:Ra,Text:lt}=Be;function Kt({currentLedgerId:m,onAddBill:y,refreshTrigger:f}){const[g,i]=l.useState(null),[x,v]=l.useState(!0),[C,Y]=l.useState(null),[B,I]=l.useState(null),R=l.useRef(null),d=l.useRef(0),W=async(X=!1)=>{if(!m){Y(null),v(!0);return}const M=++d.current;try{(X||!g)&&v(!0),Y(null);const q=await(await fetch(`/api/dashboard/summary?ledger_id=${m}`)).json();if(M!==d.current)return;q.success?(i(q.data),I(Date.now())):Y(q.error||"????????")}catch{if(M!==d.current)return;Y("??????????????")}finally{M===d.current&&v(!1)}};l.useEffect(()=>{if(!m){Y(null),v(!0);return}W(!0)},[m]),l.useEffect(()=>{f&&f!==R.current&&(R.current=f,I(f),W())},[f]),l.useEffect(()=>{const X=setInterval(()=>{!x&&m&&W()},3e5);return()=>clearInterval(X)},[x,m]);const $=()=>{W(!0)},ne=()=>{y&&y()};if(x)return e.jsxs("div",{style:{textAlign:"center",padding:"50px"},children:[e.jsx(Je,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(lt,{children:"æ­£åœ¨åŠ è½½çœ‹æ¿æ•°æ®..."})})]});if(C)return e.jsx("div",{style:{padding:"20px"},children:e.jsx(ct,{message:"æ•°æ®åŠ è½½å¤±è´¥",description:C,type:"error",showIcon:!0,action:e.jsx(j,{size:"small",onClick:$,children:"é‡è¯•"})})});if(!g)return e.jsxs("div",{style:{textAlign:"center",padding:"50px"},children:[e.jsx(lt,{children:"æš‚æ— æ•°æ®"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(j,{onClick:$,icon:e.jsx(Lt,{}),children:"åˆ·æ–°"})})]});const{monthly_spending:be,non_budget_spending:we,budget_info:ae,top_categories:_e,metadata:se}=g;return e.jsxs("div",{className:"dashboard-container",children:[e.jsxs("div",{style:{marginBottom:24,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs(Ra,{level:2,style:{margin:0},children:["è´¢åŠ¡çœ‹æ¿",x&&!g&&e.jsx(Je,{size:"small",style:{marginLeft:8}})]}),e.jsxs(lt,{type:"secondary",children:[Q(se.month,"YYYY-MM").format("YYYYå¹´Mæœˆ")," æ•°æ®æ¦‚è§ˆ",B&&e.jsxs(lt,{type:"secondary",style:{marginLeft:8,fontSize:"12px"},children:["â€¢ æ›´æ–°äº ",Q(B).format("HH:mm")]})]})]}),e.jsx(D,{children:e.jsx(j,{icon:e.jsx(Lt,{}),onClick:$,loading:x,size:"small",children:"åˆ·æ–°"})})]}),e.jsxs(T,{gutter:[16,16],children:[e.jsx(c,{xs:24,lg:12,children:e.jsx($t,{amount:be,nonBudgetAmount:we,loading:x,currency:"Â¥"})}),e.jsx(c,{xs:24,lg:12,children:e.jsx(Wt,{budgetInfo:ae,loading:x})}),e.jsx(c,{xs:24,children:e.jsx(qt,{categories:_e,loading:x})})]}),e.jsx(Ut,{onAddBill:ne,loading:x})]})}Kt.propTypes={currentLedgerId:k.number,onAddBill:k.func,refreshTrigger:k.number};Kt.defaultProps={currentLedgerId:null,onAddBill:null,refreshTrigger:null};const{Title:Ma,Text:fe}=Be,{RangePicker:Fa}=je,Ya={appTitle:"è´¦å•åŠ©æ‰‹ - React",appSubtitle:"ä¸Šä¼ è¯†åˆ«ã€æ¶ˆè´¹åˆ†æã€åˆ†ç±»é…ç½®",tabs:["è´¢åŠ¡çœ‹æ¿","ä¸Šä¼ è¯†åˆ«","æ¶ˆè´¹åˆ†æ","è®¾ç½®"],settings:{categories:"åˆ†ç±»ä¸è§„åˆ™",ledger:"è´¦æœ¬"},ledger:{label:"è´¦æœ¬",section:"è´¦æœ¬",reload:"åˆ·æ–°è´¦æœ¬",name:"åç§°",budget:"æœˆé¢„ç®—",save:"ä¿å­˜",delete:"åˆ é™¤",deleteBackup:"åˆ é™¤å¤‡ä»½",newLedger:"æ–°å»ºè´¦æœ¬",create:"åˆ›å»º",deleteConfirm:"åˆ é™¤å½“å‰è´¦æœ¬ï¼Ÿè´¦å•å°†è¢«ç§»é™¤ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆå¤‡ä»½ã€‚",deleteLast:"è‡³å°‘ä¿ç•™ä¸€ä¸ªè´¦æœ¬",backupsTitle:"è´¦æœ¬å¤‡ä»½",backupLedger:"è´¦æœ¬",backupAt:"å¤‡ä»½æ—¶é—´",backupAction:"æ“ä½œ",restore:"æ¢å¤",restoreConfirm:"ç¡®è®¤æ¢å¤è¯¥å¤‡ä»½ï¼Ÿ",deleteBackupConfirm:"ç¡®è®¤åˆ é™¤è¯¥å¤‡ä»½ï¼Ÿ",backupEmpty:"æš‚æ— å¤‡ä»½"},upload:{title:"ä¸Šä¼ è¯†åˆ«",drop:"å°†å›¾ç‰‡æ‹–åˆ°æ­¤å¤„æˆ–",choose:"é€‰æ‹©æ–‡ä»¶",billDate:"è´¦å•æ—¥æœŸ",today:"ä»Šå¤©",run:"å¼€å§‹è¯†åˆ«",addManual:"æ‰‹åŠ¨æ–°å¢ä¸€è¡Œ",results:"è¯†åˆ«ç»“æœ",saveAll:"ä¿å­˜å…¨éƒ¨",deleteSelected:"åˆ é™¤é€‰ä¸­",headers:["æ–‡ä»¶","å•†æˆ· / å…³é”®è¯","é‡‘é¢","åˆ†ç±»","æ—¥æœŸ"]},analytics:{title:"æ¶ˆè´¹åˆ†æ",keywordPH:"å…³é”®è¯",allMajors:"å…¨éƒ¨å¤§ç±»",allMinors:"å…¨éƒ¨å°ç±»",rangeToday:"å½“å¤©",rangeWeek:"å½“å‘¨",rangeMonth:"å½“æœˆ",rangeYear:"å½“å¹´",refresh:"åˆ·æ–°",reset:"é‡ç½®",totalAmount:"æ€»é‡‘é¢",count:"ç¬”æ•°",daysCovered:"è¦†ç›–å¤©æ•°",dailyAvg:"æ—¥å‡",includeInBudget:"è®¡å…¥é¢„ç®—",headers:["æ—¥æœŸ","å•†æˆ·","åˆ†ç±»","é‡‘é¢"],prev:"ä¸Šä¸€é¡µ",next:"ä¸‹ä¸€é¡µ"},config:{categoriesTitle:"åˆ†ç±»åˆ—è¡¨",major:"å¤§ç±»",minor:"å°ç±»",scope:"ä½œç”¨åŸŸ",scopeCurrent:"å½“å‰è´¦æœ¬",scopeGlobal:"è·¨è´¦æœ¬",addCategory:"æ·»åŠ åˆ†ç±»",noCategories:"æš‚æ— åˆ†ç±»ï¼Œè¯·åœ¨ä¸Šæ–¹æ·»åŠ ã€‚",rulesTitle:"åˆ†ç±»è§„åˆ™",keyword:"å…³é”®è¯",category:"åˆ†ç±»",priority:"ä¼˜å…ˆçº§",addRule:"æ·»åŠ è§„åˆ™",action:"æ“ä½œ",delete:"åˆ é™¤",tableHeaders:["å…³é”®è¯","åˆ†ç±»","ä¼˜å…ˆçº§","æ“ä½œ"],createButton:"æ–°å¢",manageButton:"æŸ¥çœ‹ä¿®æ”¹",createCategoryTitle:"æ–°å¢åˆ†ç±»",manageCategoryTitle:"æŸ¥çœ‹ä¿®æ”¹åˆ†ç±»",createRuleTitle:"æ–°å¢è§„åˆ™",manageRuleTitle:"æŸ¥çœ‹ä¿®æ”¹è§„åˆ™",filterKeyword:"å…³é”®è¯",filterMajor:"å¤§ç±»",filterMinor:"å°ç±»"},recurring:{title:"å‘¨æœŸæ€§è´¦å•",amount:"é‡‘é¢",keyword:"å…³é”®è¯",category:"åˆ†ç±»",note:"å¤‡æ³¨",scheduleType:"å¾ªç¯æ–¹å¼",scheduleWeekly:"æ¯å‘¨",scheduleMonthly:"æ¯æœˆ",weekday:"æ˜ŸæœŸ",monthDay:"æ—¥æœŸ",scheduleValue:"æ—¥æœŸ/æ˜ŸæœŸ",startDate:"å¼€å§‹æ—¥æœŸ",endDate:"ç»“æŸæ—¥æœŸ",enabled:"å¯ç”¨",includeInBudget:"è®¡å…¥é¢„ç®—",add:"æ–°å¢è§„åˆ™",createTitle:"æ–°å¢å‘¨æœŸæ€§è´¦å•",manageTitle:"æŸ¥çœ‹ä¿®æ”¹å‘¨æœŸæ€§è´¦å•",createButton:"æ–°å¢",manageButton:"æŸ¥çœ‹ä¿®æ”¹"},toasts:{loadLedgersFail:"åŠ è½½è´¦æœ¬å¤±è´¥",ledgerSaved:"è´¦æœ¬å·²ä¿å­˜",ledgerSaveFail:"ä¿å­˜å¤±è´¥",ledgerNameRequired:"è´¦æœ¬åç§°ä¸èƒ½ä¸ºç©º",ledgerCreated:"æ–°è´¦æœ¬å·²åˆ›å»º",ledgerCreateFail:"åˆ›å»ºå¤±è´¥",ledgerDeleted:"è´¦æœ¬å·²åˆ é™¤",ledgerDeleteFail:"åˆ é™¤å¤±è´¥",ledgerDeleteLast:"è‡³å°‘ä¿ç•™ä¸€ä¸ªè´¦æœ¬",enterLedgerName:"è¯·è¾“å…¥è´¦æœ¬åç§°",loadLedgerBackupsFail:"åŠ è½½å¤‡ä»½å¤±è´¥",ledgerRestored:"è´¦æœ¬å·²æ¢å¤",ledgerRestoreFail:"æ¢å¤å¤±è´¥",backupDeleted:"å¤‡ä»½å·²åˆ é™¤",backupDeleteFail:"åˆ é™¤å¤‡ä»½å¤±è´¥",loadCategoriesFail:"åŠ è½½åˆ†ç±»å¤±è´¥",loadRulesFail:"åŠ è½½è§„åˆ™å¤±è´¥",categoryAdded:"åˆ†ç±»å·²æ·»åŠ ",categoryUpdated:"åˆ†ç±»å·²æ›´æ–°",categoryAddFail:"æ·»åŠ åˆ†ç±»å¤±è´¥",categoryDeleted:"åˆ†ç±»å·²åˆ é™¤",categoryDeleteFail:"åˆ é™¤åˆ†ç±»å¤±è´¥",ruleAdded:"è§„åˆ™å·²æ·»åŠ ",ruleUpdated:"è§„åˆ™å·²æ›´æ–°",ruleAddFail:"æ·»åŠ è§„åˆ™å¤±è´¥",ruleDeleted:"è§„åˆ™å·²åˆ é™¤",ruleDeleteFail:"åˆ é™¤è§„åˆ™å¤±è´¥",chooseImage:"è¯·å…ˆé€‰æ‹©å›¾ç‰‡æ–‡ä»¶",skipDup:"å·²è·³è¿‡é‡å¤æ–‡ä»¶",uploadFail:"ä¸Šä¼ å¤±è´¥",ocrDone:"è¯†åˆ«å®Œæˆï¼š{count} æ¡è®°å½•",saveNone:"æ²¡æœ‰å¯ä¿å­˜çš„è®°å½•",saveFail:"ä¿å­˜å¤±è´¥",saveDone:"å·²ä¿å­˜",refreshFail:"åˆ·æ–°å¤±è´¥",loadRecurringFail:"åŠ è½½å‘¨æœŸæ€§è§„åˆ™å¤±è´¥",recurringAdded:"å‘¨æœŸæ€§è§„åˆ™å·²æ·»åŠ ",recurringAddFail:"æ·»åŠ å‘¨æœŸæ€§è§„åˆ™å¤±è´¥",recurringUpdated:"å‘¨æœŸæ€§è§„åˆ™å·²æ›´æ–°",recurringUpdateFail:"æ›´æ–°å‘¨æœŸæ€§è§„åˆ™å¤±è´¥",recurringDeleted:"å‘¨æœŸæ€§è§„åˆ™å·²åˆ é™¤",recurringDeleteFail:"åˆ é™¤å‘¨æœŸæ€§è§„åˆ™å¤±è´¥"},confirm:{deleteCategory:"åˆ é™¤è¯¥åˆ†ç±»ï¼Ÿ",deleteRule:"åˆ é™¤è¯¥è§„åˆ™ï¼Ÿ",deleteRecurring:"åˆ é™¤è¯¥å‘¨æœŸæ€§è§„åˆ™ï¼Ÿ"}},ue=()=>Q().format("YYYY-MM-DD"),Ne=m=>new URLSearchParams(Object.entries(m).filter(([,y])=>y!=null&&y!=="")).toString(),Ue=m=>{const y=Number(m);return Number.isNaN(y)?0:y},Aa=m=>m==="ascend"?"asc":m==="descend"?"desc":"",ot=m=>`${m.name}|${m.size}|${m.lastModified}`;function Na(){const[m,y]=l.useState("dashboard"),[f,g]=l.useState([]),[i,x]=l.useState(null),[v,C]=l.useState({name:"",monthly_budget:""}),[Y,B]=l.useState({name:"",monthly_budget:""}),[I,R]=l.useState([]),[d,W]=l.useState([]),[$,ne]=l.useState([]),[be,we]=l.useState([]),[ae,_e]=l.useState([]),[se,X]=l.useState(ue()),[M,O]=l.useState([]),[q,Z]=l.useState(!1),[le,de]=l.useState(!1),[ve,De]=l.useState(null),[P,me]=l.useState({keyword:"",major:"",minor:"",start_date:ue(),end_date:ue()}),[Ee,kr]=l.useState(null),[Tr,Sr]=l.useState([]),[Dr,Ir]=l.useState(0),[dt,He]=l.useState(1),[J,Or]=l.useState({field:"",order:""}),[ee,Ge]=l.useState([]),ut=20,[Rr,mt]=l.useState(!1),[F,Ce]=l.useState({id:null,merchant:"",amount:0,major:"",minor:"",category_id:null,category:"",bill_date:"",include_in_budget:!0}),[Mr,Jt]=l.useState(null),[te,Ve]=l.useState({major:"",minor:"",scope:"current"}),[A,Ie]=l.useState({keyword:"",major:"",minor:"",category:"",category_id:null,priority:2,scope:"current"}),[_,oe]=l.useState({amount:"",keyword:"",major:"",minor:"",category_id:null,category:"",schedule_type:"weekly",schedule_value:[1],start_date:ue(),end_date:"",enabled:!0,include_in_budget:!0}),[Fr,ht]=l.useState(!1),[Yr,Ht]=l.useState(!1),[Ar,gt]=l.useState(!1),[Gt,ke]=l.useState(""),[Nr,Vt]=l.useState(!1),[Br,pt]=l.useState(!1),[Qt,he]=l.useState(""),[Er,Xt]=l.useState(!1),[Pr,yt]=l.useState(!1),[ge,Qe]=l.useState({id:null,major:"",minor:"",scope:"current"}),[zr,xt]=l.useState(!1),[K,Oe]=l.useState({id:null,keyword:"",major:"",minor:"",category_id:null,category:"",priority:2,scope:"current"}),[H,Zt]=l.useState({keyword:"",major:"",minor:""}),[U,ft]=l.useState({keyword:"",major:"",minor:""}),[Lr,jt]=l.useState(!1),[$r,er]=l.useState(!1),[Wr,qr]=l.useState([]),[Ur,bt]=l.useState(!1),[N,pe]=l.useState(null),[Kr,wt]=l.useState(!1),[b,G]=l.useState(null),[Jr,_t]=l.useState(!1),[tr,rr]=l.useState(null),[Hr,vt]=l.useState(!1),[Gr,Ct]=l.useState(!1),[Vr,kt]=l.useState(!1),[Tt,Qr]=l.useState(!0),[Xr,Zr]=ce.useMessage(),Xe=()=>{Jt(Date.now())},n=t=>t.split(".").reduce((r,a)=>r?r[a]:void 0,Ya)||t,St="Â¥";l.useEffect(()=>{Re(),et()},[]),l.useEffect(()=>{const t=setInterval(()=>{const r=ue();X(a=>a===r?a:r),me(a=>a.start_date===a.end_date&&a.start_date!==r?{...a,start_date:r,end_date:r}:a)},6e4);return()=>clearInterval(t)},[]),l.useEffect(()=>{const t=f.find(r=>r.id===i);t&&C({name:t.name,monthly_budget:t.monthly_budget??""})},[i,f]),l.useEffect(()=>{i!==null&&(Le(),Me(),$e(),re(1))},[i]);const Pe=(t={})=>({...t,ledger_id:i??""}),o=(t,r="info")=>{const a=r==="warn"?"warning":r;Xr.open({type:a,content:t})},nr=t=>{if(!t)return"";const r=t.toLowerCase(),s=[...$].sort((h,w)=>Number(w.priority||0)-Number(h.priority||0)).find(h=>r.includes((h.keyword||"").toLowerCase()));return s?s.category:""},ar=t=>{const r=String(t||"").trim();if(!r)return{category:"",category_id:null,major:"",minor:""};const a=d.find(V=>V.full_name===r);if(a)return{category:a.full_name,category_id:a.id,major:a.major,minor:a.minor};const s=r.split("/"),h=(s[0]||"").trim(),w=(s[1]||"").trim(),S=d.find(V=>V.major===h&&V.minor===w);return S?{category:S.full_name,category_id:S.id,major:S.major,minor:S.minor}:{category:r,category_id:null,major:h,minor:w}},Ze=l.useMemo(()=>Array.from(new Set(d.map(t=>t.major))).filter(Boolean),[d]),en=l.useMemo(()=>P.major?d.filter(t=>t.major===P.major):d,[d,P.major]),Dt=l.useMemo(()=>Array.from(new Set(d.map(t=>t.major))).filter(Boolean),[d]),tn=l.useMemo(()=>A.major?d.filter(t=>t.major===A.major):[],[d,A.major]),rn=l.useMemo(()=>K.major?d.filter(t=>t.major===K.major):[],[d,K.major]),sr=l.useMemo(()=>Array.from(new Set(d.map(t=>t.major))).filter(Boolean),[d]),nn=l.useMemo(()=>_.major?d.filter(t=>t.major===_.major):[],[d,_.major]),It=[{label:"å‘¨ä¸€",value:1},{label:"å‘¨äºŒ",value:2},{label:"å‘¨ä¸‰",value:3},{label:"å‘¨å››",value:4},{label:"å‘¨äº”",value:5},{label:"å‘¨å…­",value:6},{label:"å‘¨æ—¥",value:7}],Ot=l.useMemo(()=>Array.from({length:31},(t,r)=>({label:`${r+1}æ—¥`,value:r+1})),[]),an=l.useMemo(()=>H.major?d.filter(t=>t.major===H.major):d,[d,H.major]),sn=l.useMemo(()=>{const t=H.keyword.trim().toLowerCase();return d.filter(r=>H.major&&r.major!==H.major||H.minor&&r.minor!==H.minor?!1:t?`${r.major||""}/${r.minor||""}`.toLowerCase().includes(t):!0)},[d,H]),ze=l.useMemo(()=>new Map(d.map(t=>[t.id,t])),[d]),ln=l.useMemo(()=>U.major?d.filter(t=>t.major===U.major):d,[d,U.major]),on=l.useMemo(()=>{const t=U.keyword.trim().toLowerCase();return $.filter(r=>{const a=ze.get(r.category_id),s=a?.major||(r.category||"").split("/")[0]||"",h=a?.minor||(r.category||"").split("/")[1]||"";return U.major&&s!==U.major||U.minor&&h!==U.minor?!1:t?`${r.keyword||""} ${r.category||""}`.toLowerCase().includes(t):!0})},[$,U,ze]),cn=l.useMemo(()=>F.major?d.filter(t=>t.major===F.major):d,[d,F.major]),Re=async()=>{try{const r=await(await fetch("/api/ledgers")).json();r.success?(g(r.ledgers||[]),(r.ledgers||[]).length&&i===null&&x(r.ledgers[0].id)):o(r.error||n("toasts.loadLedgersFail"),"error")}catch{o(n("toasts.loadLedgersFail"),"error")}},et=async()=>{try{const r=await(await fetch("/api/ledger-backups")).json();r.success?R(r.backups||[]):o(r.error||n("toasts.loadLedgerBackupsFail"),"error")}catch{o(n("toasts.loadLedgerBackupsFail"),"error")}},dn=async()=>{if(!v.name.trim()){o(n("toasts.ledgerNameRequired"),"warn");return}try{const t={name:v.name,monthly_budget:Ue(v.monthly_budget)},a=await(await fetch(`/api/ledgers/${i}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();a.success?(o(n("toasts.ledgerSaved"),"success"),Re(),Xe()):o(a.error||n("toasts.ledgerSaveFail"),"error")}catch{o(n("toasts.ledgerSaveFail"),"error")}},un=async()=>{if(!Y.name.trim()){o(n("toasts.enterLedgerName"),"warn");return}try{const r=await(await fetch("/api/ledgers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:Y.name,monthly_budget:Ue(Y.monthly_budget)})})).json();r.success?(o(n("toasts.ledgerCreated"),"success"),B({name:"",monthly_budget:""}),x(r.ledger_id),Re()):o(r.error||n("toasts.ledgerCreateFail"),"error")}catch{o(n("toasts.ledgerCreateFail"),"error")}},mn=()=>{if(!i){o("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè´¦æœ¬","warn");return}if(f.length<=1){o(n("toasts.ledgerDeleteLast"),"warn");return}vt(!0)},hn=async()=>{try{const r=await(await fetch(`/api/ledgers/${i}`,{method:"DELETE"})).json();r.success?(o(n("toasts.ledgerDeleted"),"success"),x(null),Re(),et(),setTimeout(()=>{window.location.reload()},500)):r.code==="last_ledger"?o(n("toasts.ledgerDeleteLast"),"warn"):o(r.error||n("toasts.ledgerDeleteFail"),"error")}catch(t){console.error("Delete error:",t),o(n("toasts.ledgerDeleteFail"),"error")}finally{vt(!1)}},gn=async t=>{try{const a=await(await fetch(`/api/ledger-backups/${t.id}/restore`,{method:"POST"})).json();a.success?(o(n("toasts.ledgerRestored"),"success"),x(a.ledger_id),Re(),et(),Xe()):o(a.error||n("toasts.ledgerRestoreFail"),"error")}catch(r){console.error("Restore error:",r),o(n("toasts.ledgerRestoreFail"),"error")}},pn=async t=>{try{const a=await(await fetch(`/api/ledger-backups/${t.id}`,{method:"DELETE"})).json();a.success?(o(n("toasts.backupDeleted"),"success"),et()):o(a.error||n("toasts.backupDeleteFail"),"error")}catch(r){console.error("Backup delete error:",r),o(n("toasts.backupDeleteFail"),"error")}},Le=async()=>{if(i!==null)try{const r=await(await fetch(`/api/config/category-groups?${Ne(Pe({}))}`)).json();r.success&&W(r.categories||[])}catch{o(n("toasts.loadCategoriesFail"),"error")}},Me=async()=>{if(i!==null)try{const r=await(await fetch(`/api/config/categories?${Ne(Pe({}))}`)).json();r.success&&ne(r.rules||[])}catch{o(n("toasts.loadRulesFail"),"error")}},$e=async()=>{if(i!==null)try{const r=await(await fetch(`/api/recurring-rules?${Ne(Pe({}))}`)).json();if(r.success){const a=(r.rules||[]).map(s=>({...s,schedule_value:Fe(s.schedule_type,s.schedule_value),include_in_budget:s.include_in_budget!==!1}));we(a)}else o(r.error||n("toasts.loadRecurringFail"),"error")}catch{o(n("toasts.loadRecurringFail"),"error")}},Rt=async()=>{try{const r=await(await fetch("/api/templates")).json();r.success?qr(r.data||[]):o(r.error||"åŠ è½½æ¨¡æ¿å¤±è´¥","error")}catch{o("åŠ è½½æ¨¡æ¿å¤±è´¥","error")}},[yn,Mt]=l.useState(!1),[Ft,lr]=l.useState(null),xn=t=>{lr(t),Mt(!0)},fn=async()=>{if(Ft)try{const r=await(await fetch(`/api/templates/${encodeURIComponent(Ft)}`,{method:"DELETE"})).json();r.success?(o("æ¨¡æ¿åˆ é™¤æˆåŠŸ","success"),Rt()):o(r.error||"åˆ é™¤æ¨¡æ¿å¤±è´¥","error")}catch{o("åˆ é™¤æ¨¡æ¿å¤±è´¥","error")}finally{Mt(!1),lr(null)}},jn=async()=>{if(N)try{const r=await(await fetch("/api/templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({template:N})})).json();r.success?(o("æ¨¡æ¿ä¿å­˜æˆåŠŸ","success"),Rt(),bt(!1),pe(null)):o(r.error||"ä¿å­˜æ¨¡æ¿å¤±è´¥","error")}catch{o("ä¿å­˜æ¨¡æ¿å¤±è´¥","error")}},bn=t=>{rr(t),_t(!0)},wn=async()=>{if(tr)try{const r=await(await fetch(`/api/recurring-rules/${tr}`,{method:"DELETE"})).json();r.success?(o("å‘¨æœŸæ€§è§„åˆ™åˆ é™¤æˆåŠŸ","success"),$e()):o(r.error||"åˆ é™¤å‘¨æœŸæ€§è§„åˆ™å¤±è´¥","error")}catch{o("åˆ é™¤å‘¨æœŸæ€§è§„åˆ™å¤±è´¥","error")}finally{_t(!1),rr(null)}},_n=async()=>{if(b)try{const t={amount:Number(b.amount)||0,keyword:b.keyword?.trim()||"",category_id:b.category_id,category:b.category||"",schedule_type:b.schedule_type,schedule_value:b.schedule_value,start_date:b.start_date,end_date:b.end_date||"",enabled:!!b.enabled,include_in_budget:!!b.include_in_budget},a=await(await fetch(`/api/recurring-rules/${b.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();a.success?(o("å‘¨æœŸæ€§è§„åˆ™ä¿å­˜æˆåŠŸ","success"),$e(),wt(!1),G(null)):o(a.error||"ä¿å­˜å‘¨æœŸæ€§è§„åˆ™å¤±è´¥","error")}catch{o("ä¿å­˜å‘¨æœŸæ€§è§„åˆ™å¤±è´¥","error")}},vn=async()=>{if(ke(""),!te.major.trim()){const t=n("toasts.categoryAddFail");return ke(t),o(t,"warn"),!1}try{const t={major:te.major.trim(),minor:te.minor.trim(),ledger_id:te.scope==="global"?null:i},r=await fetch("/api/config/category-groups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});let a=null;try{a=await r.json()}catch{a=null}if(!r.ok){const s=a?.error||n("toasts.categoryAddFail");return ke(s),!1}if(a?.success)return o(n("toasts.categoryAdded"),"success"),ke(""),Ve({major:"",minor:"",scope:te.scope}),Le(),!0;{const s=a?.error||n("toasts.categoryAddFail");ke(s)}}catch{const t=n("toasts.categoryAddFail");ke(t),o(t,"error")}return!1},Cn=async t=>{try{const a=await(await fetch(`/api/config/category-groups/${t}`,{method:"DELETE"})).json();a.success?(o(n("toasts.categoryDeleted"),"success"),Le()):o(a.error||n("toasts.categoryDeleteFail"),"error")}catch{o(n("toasts.categoryDeleteFail"),"error")}},kn=async()=>{he("");const t=A.category_id&&d.find(s=>s.id===A.category_id)||d.find(s=>s.full_name===A.category),r=t?.full_name||A.category,a=A.category_id??t?.id??null;if(!A.keyword.trim()||!r){const s=n("toasts.ruleAddFail");return he(s),o(s,"warn"),!1}try{const s={keyword:A.keyword.trim(),category:r,category_id:a,priority:Number(A.priority)||2,ledger_id:A.scope==="global"?null:i},h=await fetch("/api/config/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});let w=null;try{w=await h.json()}catch{w=null}if(!h.ok){const S=w?.error||n("toasts.ruleAddFail");return he(S),!1}if(w?.success)return o(n("toasts.ruleAdded"),"success"),he(""),Ie({keyword:"",major:"",minor:"",category:"",category_id:null,priority:2,scope:A.scope}),Me(),!0;{const S=w?.error||n("toasts.ruleAddFail");he(S)}}catch{const s=n("toasts.ruleAddFail");he(s),o(s,"error")}return!1},Tn=t=>{E.confirm({title:n("confirm.deleteRule"),okButtonProps:{danger:!0},onOk:async()=>{try{const a=await(await fetch(`/api/config/categories/${t}`,{method:"DELETE"})).json();a.success?(o(n("toasts.ruleDeleted"),"success"),Me()):o(a.error||n("toasts.ruleDeleteFail"),"error")}catch{o(n("toasts.ruleDeleteFail"),"error")}}})},Sn=async t=>{const r=String(t.major||"").trim(),a=String(t.minor||"").trim();if(!r)return o(n("toasts.categoryAddFail"),"warn"),!1;try{const s=await fetch(`/api/config/category-groups/${t.id}?${Ne(Pe({}))}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({major:r,minor:a,ledger_id:t.scope==="global"?null:i})});let h=null;try{h=await s.json()}catch{h=null}if(!s.ok)return E.error({title:"æç¤º",content:h?.error||n("toasts.categoryAddFail")}),!1;if(h?.success)return o(n("toasts.categoryUpdated"),"success"),Le(),Me(),!0;E.error({title:"æç¤º",content:h?.error||n("toasts.categoryAddFail")})}catch{o(n("toasts.categoryAddFail"),"error")}return!1},Dn=t=>{Ie(r=>({...r,major:t||"",minor:"",category:"",category_id:null}))},In=t=>{const r=d.find(a=>a.id===t);Ie(a=>({...a,minor:r?.minor||"",category:r?.full_name||"",category_id:r?r.id:null}))},On=async t=>{const r=String(t.keyword||"").trim(),a=String(t.category||"").trim(),s=Number(t.priority)||2;if(!r||!a)return o(n("toasts.ruleAddFail"),"warn"),!1;try{const w=await(await fetch(`/api/config/categories/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyword:r,category:a,category_id:t.category_id,priority:s,ledger_id:t.scope==="global"?null:i})})).json();if(w.success)return o(n("toasts.ruleUpdated"),"success"),Me(),!0;o(w.error||n("toasts.ruleAddFail"),"error")}catch{o(n("toasts.ruleAddFail"),"error")}return!1},Rn=t=>{Qe({id:t.id,major:t.major||"",minor:t.minor||"",scope:t.ledger_id===null||t.ledger_id===void 0?"global":"current"}),yt(!0)},Mn=async()=>{if(!ge.id)return;await Sn(ge)&&yt(!1)},Fn=t=>{const r=ze.get(t.category_id),a=(t.category||"").split("/"),s=r?.major||a[0]||"",h=r?.minor||a[1]||"";Oe({id:t.id,keyword:t.keyword||"",major:s,minor:h,category_id:t.category_id??r?.id??null,category:t.category||r?.full_name||"",priority:Number(t.priority)||2,scope:t.ledger_id===null||t.ledger_id===void 0?"global":"current"}),xt(!0)},Yn=t=>{Oe(r=>({...r,major:t||"",minor:"",category_id:null,category:""}))},An=t=>{const r=d.find(a=>a.id===t);Oe(a=>({...a,category_id:t||null,category:r?r.full_name:"",major:r?r.major:a.major,minor:r?r.minor:""}))},Nn=async()=>{if(!K.id)return;await On(K)&&xt(!1)},Fe=(t,r)=>{const a=Array.isArray(r)?r:r!=null?[r]:[],s=t==="weekly"?7:31,h=a.map(w=>Number(w)).filter(w=>Number.isFinite(w)&&w>=1&&w<=s);return Array.from(new Set(h)).sort((w,S)=>w-S)},Bn=t=>{oe(r=>({...r,major:t||"",minor:"",category:"",category_id:null}))},En=t=>{const r=d.find(a=>a.id===t);oe(a=>({...a,minor:r?.minor||"",category:r?.full_name||"",category_id:r?r.id:null}))},Pn=t=>{oe(r=>({...r,schedule_type:t,schedule_value:Fe(t,r.schedule_value).length?Fe(t,r.schedule_value):[1]}))},zn=t=>{const r=t?t.format("YYYY-MM-DD"):"";oe(a=>({...a,start_date:r,end_date:a.end_date&&r&&a.end_date<r?r:a.end_date}))},Ln=async()=>{if(!_.category_id&&!_.category||!_.start_date)return o(n("toasts.recurringAddFail"),"warn"),!1;const t=Fe(_.schedule_type,_.schedule_value);if(!t.length)return o(n("toasts.recurringAddFail"),"warn"),!1;const r={amount:Ue(_.amount),keyword:_.keyword,category_id:_.category_id,category:_.category,schedule_type:_.schedule_type,schedule_value:t,start_date:_.start_date,end_date:_.end_date||null,enabled:_.enabled,include_in_budget:_.include_in_budget,ledger_id:i};try{const s=await(await fetch("/api/recurring-rules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json();return s.success?(o(n("toasts.recurringAdded"),"success"),oe({amount:"",keyword:"",major:"",minor:"",category_id:null,category:"",schedule_type:"weekly",schedule_value:[1],start_date:ue(),end_date:"",enabled:!0,include_in_budget:!0}),$e(),!0):(o(s.error||n("toasts.recurringAddFail"),"error"),!1)}catch{o(n("toasts.recurringAddFail"),"error")}return!1},$n=t=>{const r=Array.from(t||[]);r.length&&_e(a=>{const s=new Set(a.map(w=>ot(w))),h=r.filter(w=>!s.has(ot(w)));return h.length<r.length&&o(n("toasts.skipDup"),"warn"),[...a,...h]})},or=(t,r=!1)=>{const a=t.category?"":nr(t.merchant||t.filename),s=t.category||a||"",h=ar(s);return{clientId:`${Date.now()}-${Math.random().toString(36).slice(2)}`,filename:t.filename||`manual-${Date.now()}`,merchant:t.merchant||"",amount:Number(t.amount||0),category:h.category,category_id:h.category_id,major:h.major,minor:h.minor,bill_date:t.bill_date||se,ledger_id:i,raw_text:t.raw_text||[],is_manual:r,selected:!1,error:t.error}},Wn=async()=>{if(!ae.length){o(n("toasts.chooseImage"),"warn");return}Z(!0);try{const t=new FormData;ae.forEach(s=>t.append("files",s)),t.append("bill_date",se),i!==null&&t.append("ledger_id",i);const a=await(await fetch("/api/upload",{method:"POST",body:t})).json();if(a.success){const s=(a.results||[]).map(h=>or(h,!1));O(h=>[...h,...s]),_e([]),a.errors&&a.errors.length&&a.errors.forEach(h=>o(h,"warn")),o(n("toasts.ocrDone").replace("{count}",s.length),"success"),cr()}else o(a.error||n("toasts.uploadFail"),"error")}catch{o(n("toasts.uploadFail"),"error")}finally{Z(!1)}},qn=()=>{O(t=>[...t,or({filename:"manual"},!0)]),cr()},We=(t,r,a)=>{O(s=>s.map(h=>{if(h.clientId!==t)return h;if(r==="major")return{...h,major:a||"",minor:"",category_id:null,category:""};if(r==="category_id"){const S=d.find(V=>V.id===a);return{...h,category_id:a||null,category:S?S.full_name:"",major:S?S.major:h.major,minor:S?S.minor:""}}const w={...h,[r]:a};if(r==="merchant"){const S=nr(a);if(S){const V=ar(S);return{...w,category:V.category,category_id:V.category_id,major:V.major,minor:V.minor}}}return w}))},Un=(t,r)=>{We(t,"major",r||""),r?De(t):ve===t&&De(null)},Kn=(t,r)=>{We(t,"category_id",r||null),ve===t&&De(null)},Jn=(t,r)=>{O(a=>a.map(s=>s.clientId===t?{...s,selected:r}:s))},Hn=()=>{O(t=>t.filter(r=>!r.selected))},Gn=async()=>{if(!M.length){o(n("toasts.saveNone"),"warn");return}de(!0);try{const t={ledger_id:i,bills:M.map(s=>({filename:s.filename||"manual",merchant:s.merchant||"",amount:Number(s.amount||0),category:s.category||s.category_id&&ze.get(s.category_id)?.full_name||"",category_id:s.category_id,bill_date:s.bill_date||se,is_manual:s.is_manual,ledger_id:i}))},a=await(await fetch("/api/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();a.success?(o(a.message||n("toasts.saveDone"),"success"),O([]),Jt(Date.now()),re(1)):o(a.error||n("toasts.saveFail"),"error")}catch{o(n("toasts.saveFail"),"error")}finally{de(!1)}},re=async(t=dt,r=null,a=null)=>{if(i===null)return;He(t);const s=a||J,h=s&&s.field&&s.order?{sort_by:s.field,sort_order:Aa(s.order)}:{},w=Pe({...r||P,...h});try{const[S,V]=await Promise.all([fetch(`/api/analytics/summary?${Ne(w)}`),fetch(`/api/bills?${Ne({...w,limit:ut,offset:(t-1)*ut})}`)]),dr=await S.json();dr.success&&kr(dr.summary);const Yt=await V.json();Yt.success&&(Sr(Yt.bills||[]),Ir(Yt.total_count||0))}catch{o(n("toasts.refreshFail"),"error")}},Vn=async()=>{if(ee.length===0){o("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è´¦å•","warn");return}Ct(!0)},Qn=async()=>{try{const r=await(await fetch("/api/bills/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bill_ids:ee,ledger_id:i})})).json();r.success?(o(`å·²åˆ é™¤ ${ee.length} æ¡è´¦å•`,"success"),Ge([]),re(),Xe()):o(r.error||"åˆ é™¤å¤±è´¥","error")}catch{o("åˆ é™¤å¤±è´¥","error")}finally{Ct(!1)}},ir=async t=>{if(ee.length===0){o("è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„è´¦å•","warn");return}Qr(t),kt(!0)},Xn=async()=>{const t=Tt?"è®¡å…¥é¢„ç®—":"ä¸è®¡å…¥é¢„ç®—";try{const a=await(await fetch("/api/bills/batch-update-budget",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bill_ids:ee,include_in_budget:Tt,ledger_id:i})})).json();a.success?(o(`å·²å°† ${ee.length} æ¡è´¦å•è®¾ä¸º${t}`,"success"),Ge([]),re(),Xe()):o(a.error||"æ“ä½œå¤±è´¥","error")}catch{o("æ“ä½œå¤±è´¥","error")}finally{kt(!1)}},tt=t=>{const r=Q();let a=r.clone(),s=r.clone();t==="today"?(a=r.clone().startOf("day"),s=r.clone().endOf("day")):t==="week"?(a=r.clone().startOf("isoWeek"),s=r.clone().endOf("isoWeek")):t==="month"?(a=r.clone().startOf("month"),s=r.clone().endOf("month")):t==="year"&&(a=r.clone().startOf("year"),s=r.clone().endOf("year"));const h={...P,start_date:a.format("YYYY-MM-DD"),end_date:s.format("YYYY-MM-DD")};me(h),He(1),re(1,h)},Zn=()=>{const t={keyword:"",major:"",minor:"",start_date:ue(),end_date:ue()};me(t),He(1),re(1,t)},ea=t=>{const r=d.find(h=>h.id===t.category_id);let a=r?.major||"",s=r?.minor||"";if(!r&&t.category){const h=t.category.split("/");a=h[0]||"",s=h[1]||""}Ce({id:t.id,merchant:t.merchant||"",amount:Number(t.amount||0),major:a,minor:s,category_id:t.category_id??null,category:t.category||"",bill_date:t.bill_date||"",include_in_budget:t.include_in_budget!==!1}),mt(!0)},ta=t=>{Ce(r=>({...r,major:t||"",minor:"",category_id:null,category:""}))},ra=t=>{const r=d.find(a=>a.id===t);Ce(a=>({...a,category_id:t||null,category:r?r.full_name:"",major:r?r.major:a.major,minor:r?r.minor:""}))},na=async()=>{if(!F.id)return;const t={merchant:F.merchant,amount:Number(F.amount||0),category_id:F.category_id,category:F.category,bill_date:F.bill_date,include_in_budget:F.include_in_budget};try{const a=await(await fetch(`/api/bills/${F.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();a.success?(o(n("toasts.saveDone"),"success"),mt(!1),re(dt)):o(a.error||n("toasts.saveFail"),"error")}catch{o(n("toasts.saveFail"),"error")}},cr=()=>{setTimeout(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},200)},aa=M.filter(t=>t.selected).map(t=>t.clientId),sa=[{title:n("upload.headers")[0],dataIndex:"filename",key:"filename",width:180},{title:n("upload.headers")[1],dataIndex:"merchant",key:"merchant",render:(t,r)=>e.jsx(z,{value:r.merchant,onChange:a=>We(r.clientId,"merchant",a.target.value)})},{title:n("upload.headers")[2],dataIndex:"amount",key:"amount",width:100,render:(t,r)=>e.jsx(ie,{min:0,value:r.amount,onChange:a=>We(r.clientId,"amount",a),style:{width:"100%"}})},{title:n("upload.headers")[3],dataIndex:"category",key:"category",width:220,render:(t,r)=>e.jsxs(D,{size:"small",children:[e.jsx(p,{value:r.major||void 0,placeholder:n("config.major"),onChange:a=>Un(r.clientId,a),allowClear:!0,style:{minWidth:100},children:Ze.map(a=>e.jsx(p.Option,{value:a,children:a},`upload-major-${a}`))}),e.jsx(p,{value:r.category_id??void 0,placeholder:n("config.minor"),onChange:a=>Kn(r.clientId,a),open:ve===r.clientId&&r.major?!0:void 0,onDropdownVisibleChange:a=>{!a&&ve===r.clientId&&De(null)},allowClear:!0,disabled:!r.major,style:{minWidth:100},children:d.filter(a=>a.major===r.major).map(a=>e.jsx(p.Option,{value:a.id,children:a.minor||a.full_name},`upload-minor-${a.id}`))})]})},{title:n("upload.headers")[4],dataIndex:"bill_date",key:"bill_date",width:150,render:(t,r)=>e.jsx(je,{value:r.bill_date?Q(r.bill_date,"YYYY-MM-DD"):null,onChange:a=>We(r.clientId,"bill_date",a?a.format("YYYY-MM-DD"):""),style:{width:"100%"}})}],la=[{title:n("analytics.headers")[0],dataIndex:"bill_date",key:"bill_date",width:140,sorter:!0,sortOrder:J.field==="bill_date"&&J.order?J.order:null},{title:n("analytics.headers")[1],dataIndex:"merchant",key:"merchant",sorter:!0,sortOrder:J.field==="merchant"&&J.order?J.order:null,render:(t,r)=>`${t||""}${r.include_in_budget===!1?"*":""}`},{title:n("analytics.headers")[2],dataIndex:"category",key:"category",width:160,sorter:!0,sortOrder:J.field==="category"&&J.order?J.order:null},{title:n("analytics.headers")[3],dataIndex:"amount",key:"amount",width:120,align:"right",sorter:!0,sortOrder:J.field==="amount"&&J.order?J.order:null,render:t=>`${St} ${Number(t).toFixed(2)}`}],oa=[{title:n("config.major"),dataIndex:"major",key:"major"},{title:n("config.minor"),dataIndex:"minor",key:"minor"},{title:n("config.scope"),dataIndex:"ledger_id",key:"scope",width:140,render:t=>t==null?n("config.scopeGlobal"):n("config.scopeCurrent")},{title:n("config.action"),key:"action",width:140,render:(t,r)=>e.jsxs(D,{children:[e.jsx(j,{type:"link",icon:e.jsx(Ke,{}),onClick:()=>Rn(r),children:"ä¿®æ”¹"}),e.jsx(At,{title:n("confirm.deleteCategory"),okText:n("config.delete"),cancelText:"å–æ¶ˆ",okButtonProps:{danger:!0},placement:"topRight",getPopupContainer:a=>a.parentElement||document.body,onConfirm:()=>Cn(r.id),children:e.jsx(j,{danger:!0,type:"link",icon:e.jsx(ye,{}),onClick:a=>a.stopPropagation(),children:n("config.delete")})})]})}],ia=[{title:n("config.tableHeaders")[0],dataIndex:"keyword",key:"keyword"},{title:n("config.tableHeaders")[1],dataIndex:"category",key:"category",render:(t,r)=>ze.get(r.category_id)?.full_name||r.category||""},{title:n("config.scope"),dataIndex:"ledger_id",key:"scope",width:140,render:t=>t==null?n("config.scopeGlobal"):n("config.scopeCurrent")},{title:n("config.tableHeaders")[2],dataIndex:"priority",key:"priority",width:120},{title:n("config.action"),key:"action",width:140,render:(t,r)=>e.jsxs(D,{children:[e.jsx(j,{type:"link",icon:e.jsx(Ke,{}),onClick:()=>Fn(r),children:"ä¿®æ”¹"}),e.jsx(j,{danger:!0,type:"link",icon:e.jsx(ye,{}),onClick:()=>Tn(r.id),children:n("config.delete")})]})}],ca=[{title:n("recurring.amount"),dataIndex:"amount",key:"amount",width:120,render:t=>`Â¥${t}`},{title:n("recurring.keyword"),dataIndex:"keyword",key:"keyword",width:160},{title:n("config.major"),dataIndex:"major",key:"major",width:120,render:(t,r)=>d.find(s=>s.id===r.category_id)?.major||""},{title:n("config.minor"),dataIndex:"minor",key:"minor",width:140,render:(t,r)=>{const a=d.find(s=>s.id===r.category_id);return a?.minor||a?.full_name||""}},{title:n("recurring.scheduleType"),dataIndex:"schedule_type",key:"schedule_type",width:140,render:t=>n(t==="weekly"?"recurring.scheduleWeekly":"recurring.scheduleMonthly")},{title:n("recurring.scheduleValue"),dataIndex:"schedule_value",key:"schedule_value",width:320,render:(t,r)=>{const a=Array.isArray(t)?t:[],s=r.schedule_type==="weekly"?It:Ot;return a.map(h=>{const w=s.find(S=>S.value===h);return w?w.label:h}).join(", ")}},{title:n("recurring.startDate"),dataIndex:"start_date",key:"start_date",width:140},{title:n("recurring.endDate"),dataIndex:"end_date",key:"end_date",width:140,render:t=>t||"-"},{title:n("recurring.includeInBudget"),dataIndex:"include_in_budget",key:"include_in_budget",width:120,render:t=>t!==!1?"æ˜¯":"å¦"},{title:n("recurring.enabled"),dataIndex:"enabled",key:"enabled",width:100,render:t=>t?"å¯ç”¨":"ç¦ç”¨"},{title:n("config.action"),key:"action",width:150,render:(t,r)=>e.jsxs(D,{children:[e.jsx(j,{type:"link",onClick:()=>{G(r),wt(!0)},children:"ç¼–è¾‘"}),e.jsx(j,{danger:!0,type:"link",icon:e.jsx(ye,{}),onClick:()=>bn(r.id),children:n("config.delete")})]})}],da=[{title:"æ¨¡æ¿åç§°",dataIndex:"name",key:"name",width:200},{title:"ä¼˜å…ˆçº§",dataIndex:"priority",key:"priority",width:100},{title:"åŒ¹é…å…³é”®è¯",dataIndex:"match",key:"match",width:300,render:t=>{const r=[];return t?.any&&r.push(...t.any),t?.all&&r.push(...t.all),t?.regex_any&&r.push(...t.regex_any),r.join(", ")}},{title:"å•†å“åè¡Œå·",dataIndex:"extract",key:"item_line",width:120,render:t=>{const r=t?.item?.line;return Array.isArray(r)?r.join(", "):r||"-"}},{title:"é‡‘é¢è¡Œå·",dataIndex:"extract",key:"amount_line",width:120,render:t=>{const r=t?.amount?.line;return Array.isArray(r)?r.join(", "):r||"-"}},{title:"æ“ä½œ",key:"action",width:150,render:(t,r)=>e.jsxs(D,{children:[e.jsx(j,{type:"link",onClick:()=>{pe(r),bt(!0)},children:"ç¼–è¾‘"}),e.jsx(j,{danger:!0,type:"link",icon:e.jsx(ye,{}),onClick:()=>xn(r.name),children:"åˆ é™¤"})]})}],ua=[{title:n("ledger.backupLedger"),dataIndex:"ledger_name",key:"ledger_name",render:(t,r)=>t||`ID ${r.ledger_id}`},{title:n("ledger.backupAt"),dataIndex:"created_at",key:"created_at",width:180},{title:n("ledger.backupAction"),key:"action",width:120,render:(t,r)=>e.jsxs(D,{children:[e.jsx(At,{title:n("ledger.restoreConfirm"),okText:n("ledger.restore"),cancelText:"å–æ¶ˆ",onConfirm:()=>gn(r),children:e.jsx(j,{type:"link",children:n("ledger.restore")})}),e.jsx(At,{title:n("ledger.deleteBackupConfirm"),okText:n("ledger.deleteBackup"),cancelText:"å–æ¶ˆ",okButtonProps:{danger:!0},onConfirm:()=>pn(r),children:e.jsx(j,{danger:!0,type:"link",icon:e.jsx(ye,{}),children:n("ledger.deleteBackup")})})]})}],ma=l.useMemo(()=>ae.map(t=>({uid:ot(t),name:t.name,status:"done"})),[ae]);return e.jsx(xa,{theme:{token:{colorPrimary:"#1890ff",borderRadius:6}},children:e.jsxs(hr,{className:"app",style:{background:`
          radial-gradient(circle at 10% 20%, rgba(79, 70, 229, 0.08), transparent 25%),
          radial-gradient(circle at 80% 0%, rgba(14, 165, 233, 0.08), transparent 25%),
          #f3f4f6
        `,padding:"5%"},children:[Zr,e.jsxs(hr.Content,{children:[e.jsxs("div",{className:"app-header",children:[e.jsxs(D,{direction:"vertical",size:2,children:[e.jsx(Ma,{level:3,children:n("appTitle")}),e.jsx(fe,{className:"muted",children:n("appSubtitle")})]}),e.jsxs(D,{size:"middle",align:"center",children:[e.jsx(fe,{strong:!0,children:n("ledger.label")}),e.jsx(p,{value:i??void 0,style:{minWidth:200},onChange:x,children:f.map(t=>e.jsxs(p.Option,{value:t.id,children:[t.name," (",n("ledger.budget"),": ",t.monthly_budget??0,")"]},t.id))}),e.jsx(j,{icon:e.jsx(Lt,{}),onClick:Re,children:n("ledger.reload")})]})]}),e.jsxs(xe,{activeKey:m,onChange:y,children:[e.jsx(xe.TabPane,{tab:n("tabs.0"),children:e.jsx(Kt,{currentLedgerId:i,onAddBill:()=>y("upload"),refreshTrigger:Mr})},"dashboard"),e.jsx(xe.TabPane,{tab:n("tabs.1"),children:e.jsx(D,{direction:"vertical",size:"large",style:{width:"100%"},children:e.jsxs(D,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(L,{title:n("upload.title"),children:e.jsxs(D,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(_r.Dragger,{multiple:!0,beforeUpload:()=>!1,fileList:ma,onChange:({fileList:t})=>$n(t.map(r=>r.originFileObj).filter(Boolean)),onRemove:t=>{_e(r=>r.filter(a=>ot(a)!==t.uid))},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(fa,{})}),e.jsx("p",{className:"ant-upload-text",children:n("upload.drop")}),e.jsx("p",{className:"ant-upload-hint",children:n("upload.choose")})]}),e.jsxs(D,{size:"middle",align:"center",wrap:!0,children:[e.jsx(j,{type:"primary",icon:e.jsx(ja,{}),onClick:Wn,loading:q,children:n("upload.run")}),e.jsx(j,{onClick:qn,children:n("upload.addManual")}),e.jsx(fe,{children:n("upload.billDate")}),e.jsx(je,{value:se?Q(se,"YYYY-MM-DD"):null,onChange:t=>X(t?t.format("YYYY-MM-DD"):ue())})]})]})}),e.jsx(L,{title:n("upload.results"),extra:e.jsxs(D,{children:[e.jsx(j,{type:"primary",icon:e.jsx(Ke,{}),onClick:Gn,loading:le,disabled:!M.length,children:n("upload.saveAll")}),e.jsx(j,{danger:!0,icon:e.jsx(ye,{}),onClick:Hn,children:n("upload.deleteSelected")})]}),children:e.jsx(Te,{rowKey:"clientId",columns:sa,dataSource:M,pagination:!1,size:"small",rowSelection:{selectedRowKeys:aa,onChange:t=>O(r=>r.map(a=>({...a,selected:t.includes(a.clientId)})))},onRow:t=>({onClick:()=>Jn(t.clientId,!t.selected)}),rowClassName:t=>t.selected?"row-selected":"",scroll:{x:900}})})]})})},"upload"),e.jsx(xe.TabPane,{tab:n("tabs.2"),children:e.jsxs(D,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsxs(L,{title:n("analytics.title"),children:[e.jsxs(T,{gutter:12,align:"middle",children:[e.jsx(c,{xs:24,md:6,children:e.jsx(z,{placeholder:n("analytics.keywordPH"),value:P.keyword,onChange:t=>me({...P,keyword:t.target.value})})}),e.jsx(c,{xs:24,md:4,children:e.jsx(p,{placeholder:n("analytics.allMajors"),value:P.major||void 0,allowClear:!0,onChange:t=>me({...P,major:t||"",minor:""}),style:{width:"100%"},children:Ze.map(t=>e.jsx(p.Option,{value:t,children:t},t))})}),e.jsx(c,{xs:24,md:4,children:e.jsx(p,{placeholder:n("analytics.allMinors"),value:P.minor||void 0,allowClear:!0,onChange:t=>me({...P,minor:t||""}),style:{width:"100%"},children:en.map(t=>e.jsx(p.Option,{value:t.minor,children:t.minor||t.full_name},t.id))})}),e.jsx(c,{xs:24,md:8,children:e.jsx(Fa,{value:P.start_date&&P.end_date?[Q(P.start_date,"YYYY-MM-DD"),Q(P.end_date,"YYYY-MM-DD")]:[],onCalendarChange:t=>{if(!t)return;const[r,a]=t;me(s=>({...s,start_date:r?r.format("YYYY-MM-DD"):s.start_date,end_date:a?a.format("YYYY-MM-DD"):s.end_date}))},onChange:t=>{if(!t||!t[0]||!t[1])return;const[r,a]=t,s={...P,start_date:r.format("YYYY-MM-DD"),end_date:a.format("YYYY-MM-DD")};me(s),He(1),re(1,s)},style:{width:"100%"}})})]}),e.jsx(T,{gutter:12,align:"middle",style:{marginTop:10},children:e.jsx(c,{flex:"auto",children:e.jsxs(D,{wrap:!0,children:[e.jsx(j,{type:"primary",onClick:()=>re(1),children:n("analytics.refresh")}),e.jsx(j,{onClick:()=>tt("today"),children:n("analytics.rangeToday")}),e.jsx(j,{onClick:()=>tt("week"),children:n("analytics.rangeWeek")}),e.jsx(j,{onClick:()=>tt("month"),children:n("analytics.rangeMonth")}),e.jsx(j,{onClick:()=>tt("year"),children:n("analytics.rangeYear")}),e.jsx(j,{onClick:Zn,children:n("analytics.reset")})]})})}),Ee&&e.jsxs(e.Fragment,{children:[e.jsx(it,{}),e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:12,md:6,children:e.jsx(L,{size:"small",children:e.jsx(nt,{title:n("analytics.totalAmount"),value:Ue(Ee.total_amount),prefix:St,precision:2})})}),e.jsx(c,{xs:12,md:6,children:e.jsx(L,{size:"small",children:e.jsx(nt,{title:n("analytics.count"),value:Ee.bill_count})})}),e.jsx(c,{xs:12,md:6,children:e.jsx(L,{size:"small",children:e.jsx(nt,{title:n("analytics.daysCovered"),value:Ee.day_count})})}),e.jsx(c,{xs:12,md:6,children:e.jsx(L,{size:"small",children:e.jsx(nt,{title:n("analytics.dailyAvg"),value:Ue(Ee.daily_avg),prefix:St,precision:2})})})]})]})]}),e.jsxs(L,{children:[ee.length>0&&e.jsxs("div",{style:{marginBottom:16,padding:"8px 16px",backgroundColor:"#f0f2f5",borderRadius:6,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(fe,{children:["å·²é€‰æ‹© ",ee.length," é¡¹"]}),e.jsxs(D,{children:[e.jsx(j,{size:"small",onClick:()=>Ge([]),children:"å–æ¶ˆé€‰æ‹©"}),e.jsx(j,{size:"small",onClick:()=>ir(!1),children:"ä¸è®¡å…¥é¢„ç®—"}),e.jsx(j,{size:"small",onClick:()=>ir(!0),children:"è®¡å…¥é¢„ç®—"}),e.jsx(j,{danger:!0,size:"small",icon:e.jsx(ye,{}),onClick:Vn,children:"åˆ é™¤"})]})]}),e.jsx(Te,{rowKey:"id",columns:la,dataSource:Tr,rowSelection:{selectedRowKeys:ee,onChange:Ge,preserveSelectedRowKeys:!0},onRow:t=>({onClick:r=>{r.target.closest(".ant-checkbox-wrapper")||ea(t)}}),onChange:(t,r,a,s)=>{const h=t?.current||1;if(s?.action==="sort"){const w=Array.isArray(a)?a[0]:a,S=w?.order?{field:w?.field||"",order:w?.order||""}:{field:"",order:""};Or(S),re(h,null,S);return}re(h)},pagination:{current:dt,pageSize:ut,total:Dr,showSizeChanger:!1},size:"middle",scroll:{x:800}})]}),e.jsx(E,{title:"ç¼–è¾‘è´¦å•",open:Rr,onCancel:()=>mt(!1),onOk:na,okText:n("ledger.save"),cancelText:"å–æ¶ˆ",style:{top:"20%"},width:700,children:e.jsxs(u,{layout:"vertical",children:[e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("upload.headers")[1],children:e.jsx(z,{value:F.merchant,onChange:t=>Ce({...F,merchant:t.target.value})})})}),e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("upload.headers")[2],children:e.jsx(ie,{min:0,value:F.amount,onChange:t=>Ce({...F,amount:t}),style:{width:"100%"}})})})]}),e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.major"),children:e.jsx(p,{value:F.major||void 0,placeholder:n("config.major"),onChange:ta,allowClear:!0,children:Ze.map(t=>e.jsx(p.Option,{value:t,children:t},`bill-edit-major-${t}`))})})}),e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.minor"),children:e.jsx(p,{value:F.category_id??void 0,placeholder:n("config.minor"),onChange:ra,disabled:!F.major,allowClear:!0,children:cn.map(t=>e.jsx(p.Option,{value:t.id,children:t.minor||t.full_name},`bill-edit-minor-${t.id}`))})})}),e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("upload.headers")[4],children:e.jsx(je,{value:F.bill_date?Q(F.bill_date,"YYYY-MM-DD"):null,onChange:t=>Ce({...F,bill_date:t?t.format("YYYY-MM-DD"):""}),style:{width:"100%"}})})})]}),e.jsx(u.Item,{label:n("analytics.includeInBudget"),children:e.jsx(at,{checked:F.include_in_budget,onChange:t=>Ce({...F,include_in_budget:t})})})]})})]})},"analytics"),e.jsx(xe.TabPane,{tab:n("tabs.3"),children:e.jsxs(xe,{defaultActiveKey:"ledger",children:[e.jsx(xe.TabPane,{tab:n("settings.ledger"),children:e.jsx(D,{direction:"vertical",size:"large",style:{width:"100%"},children:e.jsxs(T,{gutter:[16,16],children:[e.jsx(c,{span:24,children:e.jsx(L,{title:"å½“å‰è´¦æœ¬",children:e.jsxs(D,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs(u,{layout:"vertical",children:[e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("ledger.name"),children:e.jsx(z,{value:v.name,onChange:t=>C({...v,name:t.target.value})})})}),e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("ledger.budget"),children:e.jsx(ie,{min:0,value:v.monthly_budget,onChange:t=>C({...v,monthly_budget:t}),style:{width:"100%"}})})})]}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:e.jsx(j,{type:"primary",icon:e.jsx(Ke,{}),onClick:dn,children:n("ledger.save")})})]}),e.jsx(it,{style:{borderTop:"2px solid #bfbfbf",margin:"20px 0"}}),e.jsxs(T,{justify:"space-between",align:"middle",children:[e.jsx(c,{children:e.jsx(fe,{strong:!0,children:"è´¦å•è¯†åˆ«ç®¡ç†"})}),e.jsx(c,{children:e.jsxs(D,{children:[e.jsx(j,{type:"primary",onClick:()=>jt(!0),children:"æ–°å¢"}),e.jsx(j,{onClick:()=>{er(!0),Rt()},children:"æŸ¥çœ‹ä¿®æ”¹"})]})})]}),e.jsx(it,{style:{borderTop:"2px solid #bfbfbf",margin:"20px 0"}}),e.jsxs(T,{justify:"space-between",align:"middle",children:[e.jsx(c,{children:e.jsx(fe,{strong:!0,children:n("recurring.title")})}),e.jsx(c,{children:e.jsxs(D,{children:[e.jsx(j,{type:"primary",onClick:()=>ht(!0),children:n("recurring.createButton")}),e.jsx(j,{onClick:()=>{Ht(!0),$e()},children:n("recurring.manageButton")})]})})]}),e.jsx(E,{title:n("recurring.createTitle"),open:Fr,onCancel:()=>ht(!1),onOk:async()=>{await Ln()&&ht(!1)},okText:n("ledger.save"),cancelText:"å–æ¶ˆ",style:{top:"20%"},width:900,children:e.jsxs(u,{layout:"vertical",children:[e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.amount"),children:e.jsx(ie,{min:0,value:_.amount,onChange:t=>oe({..._,amount:t}),style:{width:"100%"}})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.keyword"),children:e.jsx(z,{value:_.keyword,onChange:t=>oe({..._,keyword:t.target.value})})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("config.major"),children:e.jsx(p,{value:_.major||void 0,placeholder:n("config.major"),onChange:Bn,allowClear:!0,children:sr.map(t=>e.jsx(p.Option,{value:t,children:t},t))})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("config.minor"),children:e.jsx(p,{value:_.category_id??void 0,placeholder:n("config.minor"),onChange:En,disabled:!_.major,allowClear:!0,children:nn.map(t=>e.jsx(p.Option,{value:t.id,children:t.minor||t.full_name},t.id))})})})]}),e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.scheduleType"),children:e.jsxs(p,{value:_.schedule_type,onChange:Pn,children:[e.jsx(p.Option,{value:"weekly",children:n("recurring.scheduleWeekly")}),e.jsx(p.Option,{value:"monthly",children:n("recurring.scheduleMonthly")})]})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:_.schedule_type==="weekly"?n("recurring.weekday"):n("recurring.monthDay"),children:e.jsx(p,{mode:"multiple",value:_.schedule_value,onChange:t=>oe({..._,schedule_value:t}),options:_.schedule_type==="weekly"?It:Ot})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.startDate"),children:e.jsx(je,{value:_.start_date?Q(_.start_date,"YYYY-MM-DD"):null,onChange:zn,style:{width:"100%"}})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.endDate"),children:e.jsx(je,{allowClear:!0,value:_.end_date?Q(_.end_date,"YYYY-MM-DD"):null,onChange:t=>oe({..._,end_date:t?t.format("YYYY-MM-DD"):""}),style:{width:"100%"}})})})]}),e.jsx(T,{gutter:12,children:e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.includeInBudget"),children:e.jsx(at,{checked:_.include_in_budget,onChange:t=>oe({..._,include_in_budget:t})})})})})]})}),e.jsx(E,{title:n("recurring.manageTitle"),open:Yr,onCancel:()=>Ht(!1),footer:null,style:{top:"20%"},width:1200,children:e.jsx(Te,{rowKey:"id",columns:ca,dataSource:be,pagination:{pageSize:8},scroll:{x:1360}})}),e.jsx(E,{title:"è´¦å•æ¨¡æ¿ç®¡ç†",open:$r,onCancel:()=>er(!1),footer:null,style:{top:"20%"},width:1200,children:e.jsx(Te,{rowKey:"name",columns:da,dataSource:Wr,pagination:{pageSize:8},scroll:{x:1e3}})}),e.jsx(E,{title:"åˆ é™¤æ¨¡æ¿",open:yn,onCancel:()=>Mt(!1),onOk:fn,okButtonProps:{danger:!0},okText:"åˆ é™¤",cancelText:"å–æ¶ˆ",style:{top:"20%"},children:e.jsxs("p",{children:['ç¡®å®šè¦åˆ é™¤æ¨¡æ¿ "',Ft,'" å—ï¼Ÿ']})}),e.jsx(E,{title:"ç¼–è¾‘æ¨¡æ¿",open:Ur,onCancel:()=>{bt(!1),pe(null)},onOk:jn,okText:"ä¿å­˜",cancelText:"å–æ¶ˆ",style:{top:"20%"},width:800,children:N&&e.jsxs(u,{layout:"vertical",children:[e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:"æ¨¡æ¿åç§°",children:e.jsx(z,{value:N.name,onChange:t=>pe({...N,name:t.target.value})})})}),e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:"ä¼˜å…ˆçº§",children:e.jsx(ie,{min:0,max:1e3,value:N.priority,onChange:t=>pe({...N,priority:t}),style:{width:"100%"}})})})]}),e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:"å•†å“åè¡Œå·",children:e.jsx(z,{value:Array.isArray(N.extract?.item?.line)?N.extract.item.line.join(","):N.extract?.item?.line||"",onChange:t=>{const a=t.target.value.split(",").map(s=>parseInt(s.trim())).filter(s=>!isNaN(s));pe({...N,extract:{...N.extract,item:{...N.extract?.item,line:a.length===1?a[0]:a}}})},placeholder:"ä¾‹å¦‚: 0 æˆ– 0,1,2"})})}),e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:"é‡‘é¢è¡Œå·",children:e.jsx(z,{value:Array.isArray(N.extract?.amount?.line)?N.extract.amount.line.join(","):N.extract?.amount?.line||"",onChange:t=>{const a=t.target.value.split(",").map(s=>parseInt(s.trim())).filter(s=>!isNaN(s));pe({...N,extract:{...N.extract,amount:{...N.extract?.amount,line:a.length===1?a[0]:a}}})},placeholder:"ä¾‹å¦‚: 5 æˆ– 4,5,6"})})})]}),e.jsx(u.Item,{label:"åŒ¹é…å…³é”®è¯ (any)",children:e.jsx(z.TextArea,{rows:3,value:N.match?.any?.join(`
`)||"",onChange:t=>{const r=t.target.value.split(`
`).filter(a=>a.trim());pe({...N,match:{...N.match,any:r}})},placeholder:"æ¯è¡Œä¸€ä¸ªå…³é”®è¯"})})]})}),e.jsx(E,{title:"åˆ é™¤å‘¨æœŸæ€§è§„åˆ™",open:Jr,onCancel:()=>_t(!1),onOk:wn,okButtonProps:{danger:!0},okText:"åˆ é™¤",cancelText:"å–æ¶ˆ",style:{top:"20%"},children:e.jsx("p",{children:"ç¡®å®šè¦åˆ é™¤è¿™æ¡å‘¨æœŸæ€§è§„åˆ™å—ï¼Ÿ"})}),e.jsx(E,{title:"ç¼–è¾‘å‘¨æœŸæ€§è§„åˆ™",open:Kr,onCancel:()=>{wt(!1),G(null)},onOk:_n,okText:"ä¿å­˜",cancelText:"å–æ¶ˆ",style:{top:"20%"},width:900,children:b&&e.jsxs(u,{layout:"vertical",children:[e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.amount"),children:e.jsx(ie,{min:0,value:b.amount,onChange:t=>G({...b,amount:t}),style:{width:"100%"}})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.keyword"),children:e.jsx(z,{value:b.keyword,onChange:t=>G({...b,keyword:t.target.value})})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("config.major"),children:e.jsx(p,{value:d.find(t=>t.id===b.category_id)?.major||void 0,placeholder:n("config.major"),onChange:t=>{G({...b,category_id:null,category:""})},allowClear:!0,children:sr.map(t=>e.jsx(p.Option,{value:t,children:t},t))})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("config.minor"),children:e.jsx(p,{value:b.category_id??void 0,placeholder:n("config.minor"),onChange:t=>{const r=d.find(a=>a.id===t);G({...b,category_id:t||null,category:r?r.full_name:""})},allowClear:!0,children:d.filter(t=>t.major===d.find(r=>r.id===b.category_id)?.major).map(t=>e.jsx(p.Option,{value:t.id,children:t.minor||t.full_name},t.id))})})})]}),e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.scheduleType"),children:e.jsxs(p,{value:b.schedule_type,onChange:t=>G({...b,schedule_type:t,schedule_value:Fe(t,b.schedule_value).length?Fe(t,b.schedule_value):[1]}),children:[e.jsx(p.Option,{value:"weekly",children:n("recurring.scheduleWeekly")}),e.jsx(p.Option,{value:"monthly",children:n("recurring.scheduleMonthly")})]})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.scheduleValue"),children:e.jsx(p,{mode:"multiple",value:Array.isArray(b.schedule_value)?b.schedule_value:[],onChange:t=>G({...b,schedule_value:t}),options:b.schedule_type==="weekly"?It:Ot})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.startDate"),children:e.jsx(je,{value:b.start_date?Q(b.start_date,"YYYY-MM-DD"):null,onChange:t=>G({...b,start_date:t?t.format("YYYY-MM-DD"):"",end_date:b.end_date&&t&&b.end_date<t.format("YYYY-MM-DD")?t.format("YYYY-MM-DD"):b.end_date}),style:{width:"100%"}})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.endDate"),children:e.jsx(je,{allowClear:!0,value:b.end_date?Q(b.end_date,"YYYY-MM-DD"):null,onChange:t=>G({...b,end_date:t?t.format("YYYY-MM-DD"):""}),style:{width:"100%"}})})})]}),e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.enabled"),children:e.jsx(at,{checked:!!b.enabled,onChange:t=>G({...b,enabled:t})})})}),e.jsx(c,{xs:24,md:6,children:e.jsx(u.Item,{label:n("recurring.includeInBudget"),children:e.jsx(at,{checked:b.include_in_budget!==!1,onChange:t=>G({...b,include_in_budget:t})})})})]})]})})]})})}),e.jsx(c,{span:24,children:e.jsx(L,{title:n("ledger.newLedger"),children:e.jsxs(u,{layout:"vertical",children:[e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("ledger.name"),children:e.jsx(z,{value:Y.name,onChange:t=>B({...Y,name:t.target.value})})})}),e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("ledger.budget"),children:e.jsx(ie,{min:0,value:Y.monthly_budget,onChange:t=>B({...Y,monthly_budget:t}),style:{width:"100%"}})})})]}),e.jsx(j,{type:"dashed",icon:e.jsx(wr,{}),onClick:un,children:n("ledger.create")})]})})}),e.jsx(c,{span:24,children:e.jsx(L,{title:"åˆ é™¤è´¦æœ¬",style:{borderColor:"#ff4d4f"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("p",{style:{marginBottom:16,color:"#666"},children:"åˆ é™¤å½“å‰è´¦æœ¬å°†ç§»é™¤æ‰€æœ‰ç›¸å…³æ•°æ®ï¼Œä½†ä¼šè‡ªåŠ¨ç”Ÿæˆå¤‡ä»½ï¼Œå¯åœ¨ä¸‹æ–¹æ¢å¤ã€‚"}),e.jsx(j,{danger:!0,size:"large",icon:e.jsx(ye,{}),onClick:mn,disabled:!i||f.length<=1,children:n("ledger.delete")})]})})}),e.jsx(c,{span:24,children:e.jsx(L,{title:n("ledger.backupsTitle"),children:e.jsx(Te,{rowKey:"id",columns:ua,dataSource:I,pagination:{pageSize:6},locale:{emptyText:n("ledger.backupEmpty")}})})})]})})},"ledger"),e.jsx(xe.TabPane,{tab:n("settings.categories"),children:e.jsxs(T,{gutter:[16,16],children:[e.jsx(c,{span:24,children:e.jsxs(L,{title:n("config.categoriesTitle"),children:[e.jsxs(T,{justify:"space-between",align:"middle",children:[e.jsx(c,{children:e.jsx(fe,{strong:!0,children:n("config.categoriesTitle")})}),e.jsx(c,{children:e.jsxs(D,{children:[e.jsx(j,{type:"primary",onClick:()=>gt(!0),children:n("config.createButton")}),e.jsx(j,{onClick:()=>{Vt(!0),Le()},children:n("config.manageButton")})]})})]}),e.jsxs(E,{title:n("config.createCategoryTitle"),open:Ar,onCancel:()=>{gt(!1),ke("")},onOk:async()=>{await vn()&&gt(!1)},okText:n("ledger.save"),cancelText:"å–æ¶ˆ",style:{top:"20%"},width:700,children:[Gt?e.jsx(ct,{type:"error",message:Gt,showIcon:!0,style:{marginBottom:12}}):null,e.jsxs(u,{layout:"vertical",children:[e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("config.major"),children:e.jsx(z,{value:te.major,placeholder:"",onChange:t=>Ve({...te,major:t.target.value})})})}),e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("config.minor"),children:e.jsx(z,{value:te.minor,placeholder:"",onChange:t=>Ve({...te,minor:t.target.value})})})})]}),e.jsx(T,{gutter:12,align:"middle",children:e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("config.scope"),children:e.jsxs(p,{value:te.scope,onChange:t=>Ve({...te,scope:t}),children:[e.jsx(p.Option,{value:"current",children:n("config.scopeCurrent")}),e.jsx(p.Option,{value:"global",children:n("config.scopeGlobal")})]})})})})]})]}),e.jsxs(E,{title:n("config.manageCategoryTitle"),open:Nr,onCancel:()=>Vt(!1),footer:null,style:{top:"20%"},width:900,children:[e.jsxs(D,{wrap:!0,style:{marginBottom:12},children:[e.jsx(p,{placeholder:n("config.filterMajor"),value:H.major||void 0,allowClear:!0,style:{width:200},onChange:t=>Zt({...H,major:t||"",minor:""}),children:Ze.map(t=>e.jsx(p.Option,{value:t,children:t},t))}),e.jsx(p,{placeholder:n("config.filterMinor"),value:H.minor||void 0,allowClear:!0,style:{width:200},onChange:t=>Zt({...H,minor:t||""}),children:an.map(t=>e.jsx(p.Option,{value:t.minor,children:t.minor||t.full_name},`${t.id}-minor`))})]}),e.jsx(Te,{rowKey:"id",columns:oa,dataSource:sn,pagination:{pageSize:8}})]}),e.jsx(E,{title:"ä¿®æ”¹åˆ†ç±»",open:Pr,onCancel:()=>yt(!1),onOk:Mn,okText:"ä¿®æ”¹",cancelText:"å–æ¶ˆ",style:{top:"20%"},width:600,children:e.jsxs(u,{layout:"vertical",children:[e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("config.major"),children:e.jsx(z,{value:ge.major,onChange:t=>Qe({...ge,major:t.target.value})})})}),e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("config.minor"),children:e.jsx(z,{value:ge.minor,onChange:t=>Qe({...ge,minor:t.target.value})})})})]}),e.jsx(T,{gutter:12,children:e.jsx(c,{xs:24,md:12,children:e.jsx(u.Item,{label:n("config.scope"),children:e.jsxs(p,{value:ge.scope,onChange:t=>Qe({...ge,scope:t}),children:[e.jsx(p.Option,{value:"current",children:n("config.scopeCurrent")}),e.jsx(p.Option,{value:"global",children:n("config.scopeGlobal")})]})})})})]})})]})}),e.jsx(c,{span:24,children:e.jsxs(L,{title:n("config.rulesTitle"),children:[e.jsxs(T,{justify:"space-between",align:"middle",children:[e.jsx(c,{children:e.jsx(fe,{strong:!0,children:n("config.rulesTitle")})}),e.jsx(c,{children:e.jsxs(D,{children:[e.jsx(j,{type:"primary",onClick:()=>{he(""),pt(!0)},children:n("config.createButton")}),e.jsx(j,{onClick:()=>{Xt(!0),Me()},children:n("config.manageButton")})]})})]}),e.jsxs(E,{title:n("config.createRuleTitle"),open:Br,onCancel:()=>{pt(!1),he("")},onOk:async()=>{await kn()&&pt(!1)},okText:n("ledger.save"),cancelText:"å–æ¶ˆ",style:{top:"20%"},width:900,children:[Qt?e.jsx(ct,{type:"error",message:Qt,showIcon:!0,style:{marginBottom:12}}):null,e.jsxs(u,{layout:"vertical",children:[e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.keyword"),children:e.jsx(z,{value:A.keyword,placeholder:"",onChange:t=>Ie({...A,keyword:t.target.value})})})}),e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.major"),children:e.jsx(p,{value:A.major||void 0,placeholder:n("config.major"),onChange:Dn,allowClear:!0,children:Dt.map(t=>e.jsx(p.Option,{value:t,children:t},t))})})}),e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.minor"),children:e.jsx(p,{value:A.category_id??void 0,placeholder:n("config.minor"),onChange:In,disabled:!A.major,allowClear:!0,children:tn.map(t=>e.jsx(p.Option,{value:t.id,children:t.minor||t.full_name},t.id))})})})]}),e.jsxs(T,{gutter:12,align:"middle",children:[e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.priority"),children:e.jsx(ie,{min:1,value:A.priority,onChange:t=>Ie({...A,priority:t}),style:{width:"100%"}})})}),e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.scope"),children:e.jsxs(p,{value:A.scope,onChange:t=>Ie({...A,scope:t}),children:[e.jsx(p.Option,{value:"current",children:n("config.scopeCurrent")}),e.jsx(p.Option,{value:"global",children:n("config.scopeGlobal")})]})})})]})]})]}),e.jsxs(E,{title:n("config.manageRuleTitle"),open:Er,onCancel:()=>Xt(!1),footer:null,style:{top:"20%"},width:1100,children:[e.jsxs(D,{wrap:!0,style:{marginBottom:12},children:[e.jsx(z,{placeholder:n("config.filterKeyword"),value:U.keyword,onChange:t=>ft({...U,keyword:t.target.value}),style:{width:200}}),e.jsx(p,{placeholder:n("config.filterMajor"),value:U.major||void 0,allowClear:!0,style:{width:200},onChange:t=>ft({...U,major:t||"",minor:""}),children:Dt.map(t=>e.jsx(p.Option,{value:t,children:t},`rule-major-${t}`))}),e.jsx(p,{placeholder:n("config.filterMinor"),value:U.minor||void 0,allowClear:!0,style:{width:200},onChange:t=>ft({...U,minor:t||""}),children:ln.map(t=>e.jsx(p.Option,{value:t.minor,children:t.minor||t.full_name},`rule-minor-${t.id}`))})]}),e.jsx(Te,{rowKey:"id",columns:ia,dataSource:on,pagination:{pageSize:8}})]}),e.jsx(E,{title:"ä¿®æ”¹è§„åˆ™",open:zr,onCancel:()=>xt(!1),onOk:Nn,okText:"ä¿®æ”¹",cancelText:"å–æ¶ˆ",style:{top:"20%"},width:800,children:e.jsxs(u,{layout:"vertical",children:[e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.keyword"),children:e.jsx(z,{value:K.keyword,onChange:t=>Oe({...K,keyword:t.target.value})})})}),e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.major"),children:e.jsx(p,{value:K.major||void 0,placeholder:n("config.major"),onChange:Yn,allowClear:!0,children:Dt.map(t=>e.jsx(p.Option,{value:t,children:t},`rule-edit-major-${t}`))})})}),e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.minor"),children:e.jsx(p,{value:K.category_id??void 0,placeholder:n("config.minor"),onChange:An,disabled:!K.major,allowClear:!0,children:rn.map(t=>e.jsx(p.Option,{value:t.id,children:t.minor||t.full_name},`rule-edit-minor-${t.id}`))})})})]}),e.jsxs(T,{gutter:12,children:[e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.priority"),children:e.jsx(ie,{min:1,value:K.priority,onChange:t=>Oe({...K,priority:t}),style:{width:"100%"}})})}),e.jsx(c,{xs:24,md:8,children:e.jsx(u.Item,{label:n("config.scope"),children:e.jsxs(p,{value:K.scope,onChange:t=>Oe({...K,scope:t}),children:[e.jsx(p.Option,{value:"current",children:n("config.scopeCurrent")}),e.jsx(p.Option,{value:"global",children:n("config.scopeGlobal")})]})})})]})]})})]})})]})},"categories")]})},"config")]})]}),e.jsx(Cr,{visible:Lr,onClose:()=>jt(!1),onSuccess:()=>{ce.success("æ¨¡æ¿åˆ›å»ºæˆåŠŸ"),jt(!1)}}),e.jsxs(E,{title:"ç¡®è®¤åˆ é™¤",visible:Hr,onOk:hn,onCancel:()=>vt(!1),okText:n("ledger.delete"),cancelText:"å–æ¶ˆ",okButtonProps:{danger:!0},style:{top:"20%"},children:[e.jsx("p",{children:n("ledger.deleteConfirm")}),e.jsx("p",{style:{color:"#ff4d4f",marginTop:8},children:"æ­¤æ“ä½œå°†åˆ é™¤è´¦æœ¬åŠå…¶æ‰€æœ‰è´¦å•æ•°æ®ï¼Œå¹¶ç”Ÿæˆå¤‡ä»½å¯ä¾›æ¢å¤ã€‚"})]}),e.jsxs(E,{title:"ç¡®è®¤åˆ é™¤",visible:Gr,onOk:Qn,onCancel:()=>Ct(!1),okText:"åˆ é™¤",cancelText:"å–æ¶ˆ",okButtonProps:{danger:!0},style:{top:"20%"},children:[e.jsxs("p",{children:["ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ",ee.length," æ¡è´¦å•å—ï¼Ÿ"]}),e.jsx("p",{style:{color:"#ff4d4f",marginTop:8},children:"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œã€‚"})]}),e.jsx(E,{title:"ç¡®è®¤æ“ä½œ",visible:Vr,onOk:Xn,onCancel:()=>kt(!1),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",style:{top:"20%"},children:e.jsxs("p",{children:["ç¡®å®šè¦å°†é€‰ä¸­çš„ ",ee.length," æ¡è´¦å•è®¾ä¸º",Tt?"è®¡å…¥é¢„ç®—":"ä¸è®¡å…¥é¢„ç®—","å—ï¼Ÿ"]})})]})})}ba.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(Na,{})}));
