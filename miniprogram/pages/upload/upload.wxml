<!--pages/upload/upload.wxml-->
<view class="upload-container">
  <!-- ä¸Šä¼ åŒºåŸŸå¡ç‰‡ -->
  <view class="card upload-card">
    <view class="card-header">
      <text class="card-title">ğŸ“· ä¸Šä¼ è´¦å•å›¾ç‰‡</text>
    </view>
    
    <!-- å›¾ç‰‡ç½‘æ ¼ -->
    <view class="image-grid">
      <view wx:for="{{selectedImages}}" wx:key="path" class="image-item">
        <image src="{{item.path}}" mode="aspectFill" class="preview-image"/>
        <view class="remove-btn" data-index="{{index}}" bindtap="handleRemoveImage">Ã—</view>
      </view>
      
      <!-- æ·»åŠ æŒ‰é’® -->
      <view class="add-image-btn" bindtap="handleChooseImage">
        <text class="add-icon">+</text>
        <text class="add-text">æ·»åŠ </text>
      </view>
    </view>

    <!-- æ—¥æœŸå’Œè¯†åˆ«æ§åˆ¶ -->
    <view class="control-section">
      <view class="date-row">
        <text class="control-label">è´¦å•æ—¥æœŸ</text>
        <view class="date-controls">
          <picker mode="date" value="{{billDate}}" bindchange="handleDateChange">
            <view class="date-picker">
              <text class="date-value">{{billDate}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
          <view class="btn-today" bindtap="handleSetToday">ä»Šå¤©</view>
        </view>
      </view>

      <button 
        class="btn-recognize" 
        bindtap="handleUpload"
        disabled="{{uploading || selectedImages.length === 0}}"
      >
        <text wx:if="{{uploading}}" class="btn-icon">â³</text>
        <text wx:else class="btn-icon">ğŸ”</text>
        <text>{{uploading ? 'è¯†åˆ«ä¸­...' : 'å¼€å§‹è¯†åˆ«'}}</text>
      </button>
    </view>
  </view>

  <!-- è¯†åˆ«ç»“æœå¡ç‰‡ -->
  <view wx:if="{{results.length > 0}}" class="card results-card">
    <view class="results-header">
      <text class="card-title">ğŸ“‹ è¯†åˆ«ç»“æœ</text>
      <text class="results-count">{{results.length}}æ¡</text>
    </view>

    <!-- ç»“æœåˆ—è¡¨ -->
    <view class="result-list">
      <view wx:for="{{results}}" wx:key="id" class="result-card {{item.selected ? 'selected' : ''}}">
        <!-- å¡ç‰‡å¤´éƒ¨ï¼šé€‰æ‹©æ¡†å’Œåˆ é™¤ -->
        <view class="result-header">
          <view class="checkbox-wrap" data-index="{{index}}" bindtap="handleToggleSelect">
            <view class="checkbox {{item.selected ? 'checked' : ''}}">
              <text wx:if="{{item.selected}}" class="check-icon">âœ“</text>
            </view>
          </view>
          <view class="result-date-badge">{{item.bill_date}}</view>
          <view class="delete-action" data-index="{{index}}" bindtap="handleDeleteResult">åˆ é™¤</view>
        </view>

        <!-- é‡‘é¢çªå‡ºæ˜¾ç¤º -->
        <view class="amount-display">
          <text class="currency">Â¥</text>
          <input 
            class="amount-number" 
            type="digit"
            value="{{item.amount}}" 
            placeholder="0.00"
            data-index="{{index}}"
            bindinput="handleAmountInput"
          />
        </view>

        <!-- å•†æˆ·å’Œåˆ†ç±» -->
        <view class="detail-grid">
          <view class="detail-item">
            <text class="detail-label">å•†æˆ·</text>
            <input 
              class="detail-input" 
              value="{{item.merchant}}" 
              placeholder="å•†æˆ·åç§°"
              data-index="{{index}}"
              bindinput="handleMerchantInput"
            />
          </view>
          <view class="detail-item">
            <text class="detail-label">åˆ†ç±»</text>
            <picker 
              class="detail-picker"
              range="{{categories}}" 
              range-key="full_name"
              data-index="{{index}}"
              bindchange="handleCategoryChange"
            >
              <view class="picker-display">
                <text class="picker-text">{{item.category || 'é€‰æ‹©åˆ†ç±»'}}</text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‰‹åŠ¨æ–°å¢æµ®åŠ¨æŒ‰é’® -->
  <view class="fab-add" bindtap="handleAddManual">
    <text class="fab-icon">+</text>
  </view>

  <!-- åº•éƒ¨å›ºå®šæ“ä½œæ  -->
  <view class="footer-bar" wx:if="{{results.length > 0}}">
    <view class="footer-left" bindtap="handleSelectAll">
      <view class="checkbox {{allSelected ? 'checked' : ''}}">
        <text wx:if="{{allSelected}}" class="check-icon">âœ“</text>
      </view>
      <text class="select-text">å…¨é€‰</text>
    </view>
    <view class="footer-right">
      <button class="btn-footer btn-delete" bindtap="handleDeleteSelected" disabled="{{!hasSelectedItems}}">åˆ é™¤</button>
      <button class="btn-footer btn-save" bindtap="handleSaveAll" disabled="{{saving}}">ä¿å­˜å…¨éƒ¨</button>
    </view>
  </view>
</view>
